{"version":3,"sources":["assets/scripts/CityScript.js"],"names":["TankType","require","tankType","alert","cc","Class","Component","properties","curMap","TiledMap","yaogan","Node","bullet","Prefab","tank","type","maxCount","life","bornPoses","Vec2","spriteFrames","SpriteFrame","tankSpeeds","Float","tankFireTimes","tankBloods","Integer","enemyNum","Label","lifeNum","onLoad","_joystickCtrl","getComponent","_tiledMap","string","start","err","curAngle","self","registerInputEvent","_tiledMapData","_curMapTileSize","getTileSize","_curMapSize","v2","node","width","height","mapLayer0","getLayer","bulletPool","NodePool","initBulletCount","i","instantiate","put","tankPool","gameData","teamId","single","tankList","bulletList","tankNode","find","player","addPlayerTank","_playerTankCtrl","schedule","addAITank","macro","REPEAT_FOREVER","addJoyStickTouchChangeListener","angle","stopMove","tankMoveStart","tankMoveStop","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","KEY","w","s","a","d","k","fireBtnClick","KEY_UP","collisionTest","rect","xMin","x","xMax","yMin","y","yMax","MinY","MaxY","MinX","MaxX","LeftDown","RightDown","LeftUp","RightUp","MidDown","MidUp","MidLeft","MidRight","_collisionTest","points","point","shift","gid","getTileGIDAt","parseInt","gidToTileType","tileType","tileNone","tileGrass","tileWall","setTileGIDAt","tileKing","gameOver","length","tankCtrl","tankStop","show","call","director","loadScene","team","size","get","Sprite","spriteFrame","position","Player","speed","fireTime","blood","die","parent","push","dt","index","Math","random","collisionTank","getBoundingBox","tankBoom","tankNum","Number","startFire","audioEngine","play","shootAudio","onDestroy","unschedule"],"mappings":";;;;;;AAAA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAP,CAAoBC,QAAnC;;AACA,IAAIC,KAAK,GAAGF,OAAO,CAAC,OAAD,CAAnB;;AAGAG,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AAER;AACAC,IAAAA,MAAM,EAAEJ,EAAE,CAACK,QAHH;AAIR;AACAC,IAAAA,MAAM,EAAEN,EAAE,CAACO,IALH;AAOR;AACAC,IAAAA,MAAM,EAAER,EAAE,CAACS,MARH;AASR;AACAC,IAAAA,IAAI,EAAE;AACF,iBAAS,IADP;AAEFC,MAAAA,IAAI,EAAEX,EAAE,CAACS;AAFP,KAVE;AAcR;AACAG,IAAAA,QAAQ,EAAE,CAfF;AAgBRC,IAAAA,IAAI,EAAE,CAhBE;AAiBR;AACAC,IAAAA,SAAS,EAAE;AACP,iBAAS,EADF;AAEPH,MAAAA,IAAI,EAAEX,EAAE,CAACe;AAFF,KAlBH;AAsBR;AACAC,IAAAA,YAAY,EAAE;AACV,iBAAS,EADC;AAEVL,MAAAA,IAAI,EAAEX,EAAE,CAACiB;AAFC,KAvBN;AA2BR;AACAC,IAAAA,UAAU,EAAE;AACR,iBAAS,EADD;AAERP,MAAAA,IAAI,EAAEX,EAAE,CAACmB;AAFD,KA5BJ;AAgCR;AACAC,IAAAA,aAAa,EAAE;AACX,iBAAS,EADE;AAEXT,MAAAA,IAAI,EAAEX,EAAE,CAACmB;AAFE,KAjCP;AAsCR;AACAE,IAAAA,UAAU,EAAE;AACR,iBAAS,EADD;AAERV,MAAAA,IAAI,EAAEX,EAAE,CAACsB;AAFD,KAvCJ;AA4CRC,IAAAA,QAAQ,EAAE;AACNZ,MAAAA,IAAI,EAAEX,EAAE,CAACwB,KADH;AAEN,iBAAS;AAFH,KA5CF;AAgDRC,IAAAA,OAAO,EAAE;AACLd,MAAAA,IAAI,EAAEX,EAAE,CAACwB,KADJ;AAEL,iBAAS;AAFJ;AAhDD,GAHP;AA0DL;AACAE,EAAAA,MAAM,EAAE,kBAAY;AAChB;AACA;AACA,SAAKC,aAAL,GAAqB,KAAKrB,MAAL,CAAYsB,YAAZ,CAAyB,cAAzB,CAArB,CAHgB,CAIhB;;AACA,SAAKC,SAAL,GAAiB,KAAKzB,MAAL,CAAYwB,YAAZ,CAAyB,aAAzB,CAAjB;AACA,SAAKL,QAAL,CAAcO,MAAd,GAAuB,KAAKlB,QAAL,GAAgB,EAAvC;AACA,SAAKa,OAAL,CAAaK,MAAb,GAAsB,KAAKjB,IAAL,GAAY,EAAlC;AACH,GAnEI;AAqELkB,EAAAA,KAAK,EAAE,eAASC,GAAT,EAAa;AAChB,QAAGA,GAAH,EAAO;AACH;AACH,KAHe,CAKhB;;;AACA,SAAKC,QAAL,GAAgB,IAAhB;AAEA,QAAIC,IAAI,GAAG,IAAX,CARgB,CAShB;;AACA,SAAKC,kBAAL,GAVgB,CAWhB;;AACA,SAAKC,aAAL,GAAqBvC,OAAO,CAAC,cAAD,CAA5B,CAZgB,CAchB;;AACA,SAAKwC,eAAL,GAAuB,KAAKR,SAAL,CAAeS,WAAf,EAAvB;AACA,SAAKC,WAAL,GAAmBvC,EAAE,CAACwC,EAAH,CAAM,KAAKX,SAAL,CAAeY,IAAf,CAAoBC,KAA1B,EAAgC,KAAKb,SAAL,CAAeY,IAAf,CAAoBE,MAApD,CAAnB,CAhBgB,CAkBhB;;AACA,SAAKC,SAAL,GAAiB,KAAKf,SAAL,CAAegB,QAAf,CAAwB,SAAxB,CAAjB,CAnBgB,CAqBhB;;AACA,SAAKC,UAAL,GAAkB,IAAI9C,EAAE,CAAC+C,QAAP,CAAgB,cAAhB,CAAlB;AACA,QAAIC,eAAe,GAAG,EAAtB;;AACA,SAAI,IAAIC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACD,eAAf,EAAgC,EAAEC,CAAlC,EAAoC;AAChC,UAAIzC,MAAM,GAAGR,EAAE,CAACkD,WAAH,CAAe,KAAK1C,MAApB,CAAb;AACA,WAAKsC,UAAL,CAAgBK,GAAhB,CAAoB3C,MAApB;AACH;;AACD,SAAK4C,QAAL,GAAgB,IAAIpD,EAAE,CAAC+C,QAAP,CAAgB,YAAhB,CAAhB;;AACA,SAAI,IAAIE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,KAAKrC,QAApB,EAA8B,EAAEqC,CAAhC,EAAkC;AAC9B,UAAIvC,IAAI,GAAGV,EAAE,CAACkD,WAAH,CAAe,KAAKxC,IAApB,CAAX;AACA,WAAK0C,QAAL,CAAcD,GAAd,CAAkBzC,IAAlB;AACH;;AACD,QAAG,CAACV,EAAE,CAACqD,QAAP,EAAgB;AACZrD,MAAAA,EAAE,CAACqD,QAAH,GAAc,EAAd;AACH,KAnCe,CAoChB;;;AACArD,IAAAA,EAAE,CAACqD,QAAH,CAAYC,MAAZ,GAAqB,CAArB,CArCgB,CAsChB;;AACAtD,IAAAA,EAAE,CAACqD,QAAH,CAAYE,MAAZ,GAAqB,IAArB,CAvCgB,CAyChB;;AACAvD,IAAAA,EAAE,CAACqD,QAAH,CAAYG,QAAZ,GAAuB,EAAvB,CA1CgB,CA2ChB;;AACAxD,IAAAA,EAAE,CAACqD,QAAH,CAAYI,UAAZ,GAAyB,EAAzB,CA5CgB,CA8ChB;;AACA,SAAKC,QAAL,GAAgB1D,EAAE,CAAC2D,IAAH,CAAQ,kBAAR,CAAhB,CA/CgB,CAgDhB;;AACA,SAAKC,MAAL,GAAc,KAAKC,aAAL,EAAd,CAjDgB,CAkDhB;;AACA,SAAKC,eAAL,GAAuB,KAAKF,MAAL,CAAYhC,YAAZ,CAAyB,YAAzB,CAAvB,CAnDgB,CAqDhB;;AACA,SAAKmC,QAAL,CAAc,KAAKC,SAAnB,EAA6B,CAA7B,EAA+BhE,EAAE,CAACiE,KAAH,CAASC,cAAxC,EAAuD,CAAvD;AAEH,GA7HI;AA+HL;AACA/B,EAAAA,kBAAkB,EAAE,8BAAY;AAE5B,QAAID,IAAI,GAAG,IAAX;;AAEA,SAAKP,aAAL,CAAmBwC,8BAAnB,CAAkD,UAAUC,KAAV,EAAiB;AAE/D,UAAGA,KAAK,IAAIlC,IAAI,CAACD,QAAd,IACC,CAACC,IAAI,CAAC4B,eAAL,CAAqBO,QAD1B,EACoC;AAChC;AACH;;AACDnC,MAAAA,IAAI,CAACD,QAAL,GAAgBmC,KAAhB;;AAEA,UAAGA,KAAK,IAAE,IAAV,EAAe;AACX;AACAlC,QAAAA,IAAI,CAAC4B,eAAL,CAAqBQ,aAArB,CAAmCF,KAAnC;AACH,OAHD,MAGM;AACF;AACAlC,QAAAA,IAAI,CAAC4B,eAAL,CAAqBS,YAArB;AACH;AAEJ,KAhBD,EAJ4B,CAqB5B;;;AACAvE,IAAAA,EAAE,CAACwE,WAAH,CAAeC,EAAf,CAAkBzE,EAAE,CAAC0E,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EACgB,UAAUC,KAAV,EAAiB;AACb,UAAIT,KAAK,GAAG,IAAZ;;AACA,cAAOS,KAAK,CAACC,OAAb;AACI,aAAK9E,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaC,CAAlB;AACIZ,UAAAA,KAAK,GAAG,EAAR;AACA;;AACJ,aAAKpE,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaE,CAAlB;AACIb,UAAAA,KAAK,GAAG,GAAR;AACA;;AACJ,aAAKpE,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaG,CAAlB;AACId,UAAAA,KAAK,GAAG,GAAR;AACA;;AACJ,aAAKpE,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaI,CAAlB;AACIf,UAAAA,KAAK,GAAG,CAAR;AACA;AAZR;;AAcA,UAAGS,KAAK,CAACC,OAAN,IAAiB9E,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaK,CAAjC,EAAmC;AAC/B,aAAKC,YAAL;AACH,OAFD,MAEM;AACFnD,QAAAA,IAAI,CAAC4B,eAAL,CAAqBS,YAArB;AACH;;AACD,UAAGH,KAAK,IAAE,IAAV,EAAe;AACX;AACAlC,QAAAA,IAAI,CAAC4B,eAAL,CAAqBQ,aAArB,CAAmCF,KAAnC;AACH;AACJ,KA1BjB,EA0BmB,IA1BnB,EAtB4B,CAiD5B;;AACApE,IAAAA,EAAE,CAACwE,WAAH,CAAeC,EAAf,CAAkBzE,EAAE,CAAC0E,WAAH,CAAeC,SAAf,CAAyBW,MAA3C,EACgB,UAAUT,KAAV,EAAgB;AACZ;AACA,UAAGA,KAAK,CAACC,OAAN,IAAiB9E,EAAE,CAACiE,KAAH,CAASc,GAAT,CAAaK,CAAjC,EAAmC;AAC/BlD,QAAAA,IAAI,CAAC4B,eAAL,CAAqBS,YAArB;AACH;AACJ,KANjB,EAMmB,IANnB;AAQH,GA1LI;AA4LL;AACAgB,EAAAA,aAAa,EAAE,uBAASC,IAAT,EAAehF,MAAf,EAAsB;AACjC;AACA,QAAIgF,IAAI,CAACC,IAAL,IAAa,CAAC,KAAKlD,WAAL,CAAiBmD,CAAlB,GAAoB,CAAjC,IAAsCF,IAAI,CAACG,IAAL,IAAa,KAAKpD,WAAL,CAAiBmD,CAAjB,GAAmB,CAAtE,IACNF,IAAI,CAACI,IAAL,IAAa,CAAC,KAAKrD,WAAL,CAAiBsD,CAAlB,GAAoB,CAD3B,IACgCL,IAAI,CAACM,IAAL,IAAa,KAAKvD,WAAL,CAAiBsD,CAAjB,GAAmB,CADpE,EACsE;AAElE,aAAO,IAAP;AACH,KANgC,CAOjC;AACA;;;AACA,QAAIE,IAAI,GAAG,KAAKxD,WAAL,CAAiBsD,CAAjB,GAAmB,CAAnB,GAAuBL,IAAI,CAACI,IAAvC;AACH,QAAII,IAAI,GAAG,KAAKzD,WAAL,CAAiBsD,CAAjB,GAAmB,CAAnB,GAAuBL,IAAI,CAACM,IAAvC;AACG,QAAIG,IAAI,GAAG,KAAK1D,WAAL,CAAiBmD,CAAjB,GAAmB,CAAnB,GAAuBF,IAAI,CAACC,IAAvC;AACA,QAAIS,IAAI,GAAG,KAAK3D,WAAL,CAAiBmD,CAAjB,GAAmB,CAAnB,GAAuBF,IAAI,CAACG,IAAvC,CAZiC,CAcjC;;AACA,QAAIQ,QAAQ,GAAGnG,EAAE,CAACwC,EAAH,CAAMyD,IAAN,EAAYF,IAAZ,CAAf;AACA,QAAIK,SAAS,GAAGpG,EAAE,CAACwC,EAAH,CAAM0D,IAAN,EAAYH,IAAZ,CAAhB;AACA,QAAIM,MAAM,GAAGrG,EAAE,CAACwC,EAAH,CAAMyD,IAAN,EAAYD,IAAZ,CAAb;AACA,QAAIM,OAAO,GAAGtG,EAAE,CAACwC,EAAH,CAAM0D,IAAN,EAAYF,IAAZ,CAAd,CAlBiC,CAoBjC;;AACA,QAAIO,OAAO,GAAGvG,EAAE,CAACwC,EAAH,CAAMyD,IAAI,GAAC,CAACC,IAAI,GAACD,IAAN,IAAY,CAAvB,EAA0BF,IAA1B,CAAd;AACA,QAAIS,KAAK,GAAGxG,EAAE,CAACwC,EAAH,CAAMyD,IAAI,GAAC,CAACC,IAAI,GAACD,IAAN,IAAY,CAAvB,EAA0BD,IAA1B,CAAZ;AACA,QAAIS,OAAO,GAAGzG,EAAE,CAACwC,EAAH,CAAMyD,IAAN,EAAYF,IAAI,GAAC,CAACC,IAAI,GAACD,IAAN,IAAY,CAA7B,CAAd;AACA,QAAIW,QAAQ,GAAE1G,EAAE,CAACwC,EAAH,CAAM0D,IAAN,EAAYH,IAAI,GAAC,CAACC,IAAI,GAACD,IAAN,IAAY,CAA7B,CAAd,CAxBiC,CA0BjC;;AACA,WAAO,KAAKY,cAAL,CAAoB,CAACR,QAAD,EAAUC,SAAV,EAAoBC,MAApB,EAA2BC,OAA3B,EACXC,OADW,EACHC,KADG,EACGC,OADH,EACWC,QADX,CAApB,EAESlG,MAFT,CAAP;AAGH,GA3NI;AA6NL;AACAmG,EAAAA,cAAc,EAAE,wBAASC,MAAT,EAAiBpG,MAAjB,EAAwB;AACpC,QAAIqG,KAAK,GAAGD,MAAM,CAACE,KAAP,EAAZ;AACA,QAAIC,GAAG,GAAG,KAAKnE,SAAL,CAAeoE,YAAf,CAA4BhH,EAAE,CAACwC,EAAH,CAAMyE,QAAQ,CAACJ,KAAK,CAACnB,CAAN,GAAU,KAAKrD,eAAL,CAAqBK,KAAhC,CAAd,EAAqDuE,QAAQ,CAACJ,KAAK,CAAChB,CAAN,GAAU,KAAKxD,eAAL,CAAqBM,MAAhC,CAA7D,CAA5B,CAAV;;AAEA,QAAI,KAAKP,aAAL,CAAmB8E,aAAnB,CAAiCH,GAAjC,KAAyC,KAAK3E,aAAL,CAAmB+E,QAAnB,CAA4BC,QAArE,IACA,KAAKhF,aAAL,CAAmB8E,aAAnB,CAAiCH,GAAjC,KAAyC,KAAK3E,aAAL,CAAmB+E,QAAnB,CAA4BE,SADzE,EACmF;AAC/E,UAAG7G,MAAM,IAAI,KAAK4B,aAAL,CAAmB8E,aAAnB,CAAiCH,GAAjC,KAAyC,KAAK3E,aAAL,CAAmB+E,QAAnB,CAA4BG,QAAlF,EAA2F;AACvF,aAAK1E,SAAL,CAAe2E,YAAf,CAA4B,CAA5B,EAA+BN,QAAQ,CAACJ,KAAK,CAACnB,CAAN,GAAU,KAAKrD,eAAL,CAAqBK,KAAhC,CAAvC,EAA8EuE,QAAQ,CAACJ,KAAK,CAAChB,CAAN,GAAU,KAAKxD,eAAL,CAAqBM,MAAhC,CAAtF,EAA+H,CAA/H;AACH,OAFD,MAGK,IAAGnC,MAAM,IAAI,KAAK4B,aAAL,CAAmB8E,aAAnB,CAAiCH,GAAjC,KAAyC,KAAK3E,aAAL,CAAmB+E,QAAnB,CAA4BK,QAAlF,EAA2F;AAE5F,aAAK5E,SAAL,CAAe2E,YAAf,CAA4B,CAA5B,EAA+B,EAA/B,EAAmC,EAAnC,EAAuC,CAAvC;AACA,aAAK3E,SAAL,CAAe2E,YAAf,CAA4B,CAA5B,EAA+B,EAA/B,EAAmC,EAAnC,EAAuC,CAAvC;AACA,aAAK3E,SAAL,CAAe2E,YAAf,CAA4B,CAA5B,EAA+B,EAA/B,EAAmC,EAAnC,EAAuC,CAAvC;AACA,aAAK3E,SAAL,CAAe2E,YAAf,CAA4B,CAA5B,EAA+B,EAA/B,EAAmC,EAAnC,EAAuC,CAAvC;AAEA,aAAKE,QAAL;AACH;;AACD,aAAO,IAAP;AACH;;AACD,QAAGb,MAAM,CAACc,MAAP,GAAc,CAAjB,EAAmB;AACf,aAAO,KAAKf,cAAL,CAAoBC,MAApB,EAA4BpG,MAA5B,CAAP;AACH,KAFD,MAEK;AACD,aAAO,KAAP;AACH;AACJ,GAvPI;AAyPLiH,EAAAA,QAAQ,EAAE,oBAAU;AAEhB,SAAI,IAAIxE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACjD,EAAE,CAACqD,QAAH,CAAYG,QAAZ,CAAqBkE,MAApC,EAA4CzE,CAAC,EAA7C,EAAgD;AAC5C,UAAIvC,IAAI,GAAGV,EAAE,CAACqD,QAAH,CAAYG,QAAZ,CAAqBP,CAArB,CAAX;AACA,UAAI0E,QAAQ,GAAGjH,IAAI,CAACkB,YAAL,CAAkB,YAAlB,CAAf;AACA+F,MAAAA,QAAQ,CAACC,QAAT;AACH,KANe,CAQhB;;;AACA7H,IAAAA,KAAK,CAAC8H,IAAN,CAAWC,IAAX,CAAgB,IAAhB,EAAsB,MAAtB,EAA8B,YAAY;AACtC9H,MAAAA,EAAE,CAAC+H,QAAH,CAAYC,SAAZ,CAAsB,YAAtB;AACH,KAFD;AAGH,GArQI;AAuQL;AACAnE,EAAAA,aAAa,EAAE,uBAASoE,IAAT,EAAe;AAC1B,QAAG,KAAK7E,QAAL,CAAc8E,IAAd,KAAqB,CAAxB,EAA0B;AACtB,UAAIxH,IAAI,GAAG,KAAK0C,QAAL,CAAc+E,GAAd,EAAX;AACAzH,MAAAA,IAAI,CAACkB,YAAL,CAAkB5B,EAAE,CAACoI,MAArB,EAA6BC,WAA7B,GAA2C,KAAKrH,YAAL,CAAkB,KAAKA,YAAL,CAAkB0G,MAAlB,GAAyB,CAA3C,CAA3C;AACAhH,MAAAA,IAAI,CAAC4H,QAAL,GAAgB,KAAKxH,SAAL,CAAe,KAAKA,SAAL,CAAe4G,MAAf,GAAsB,CAArC,CAAhB,CAHsB,CAItB;;AACA,UAAIC,QAAQ,GAAGjH,IAAI,CAACkB,YAAL,CAAkB,YAAlB,CAAf,CALsB,CAMtB;;AACA+F,MAAAA,QAAQ,CAAC7H,QAAT,GAAoBF,QAAQ,CAAC2I,MAA7B;AACAZ,MAAAA,QAAQ,CAACa,KAAT,GAAiB,KAAKtH,UAAL,CAAgB,KAAKA,UAAL,CAAgBwG,MAAhB,GAAuB,CAAvC,CAAjB;AACAC,MAAAA,QAAQ,CAACc,QAAT,GAAoB,KAAKrH,aAAL,CAAmB,KAAKA,aAAL,CAAmBsG,MAAnB,GAA0B,CAA7C,CAApB,CATsB,CAUtB;AACA;;AACAC,MAAAA,QAAQ,CAACe,KAAT,GAAiB,CAAjB;AACAf,MAAAA,QAAQ,CAACgB,GAAT,GAAe,KAAf;;AAEA,UAAG,CAACV,IAAJ,EAAS;AACL,YAAGjI,EAAE,CAACqD,QAAH,CAAYE,MAAf,EAAsB;AAClB;AACAoE,UAAAA,QAAQ,CAACM,IAAT,GAAgB,CAAhB;AACH,SAHD,MAGM;AACF;AACAN,UAAAA,QAAQ,CAACM,IAAT,GAAgB,EAAEjI,EAAE,CAACqD,QAAH,CAAYC,MAA9B;AACH;AAEJ,OATD,MASM;AACF;AACAqE,QAAAA,QAAQ,CAACM,IAAT,GAAgBA,IAAhB;AACH;;AAEDvH,MAAAA,IAAI,CAACkI,MAAL,GAAc,KAAKlF,QAAnB,CA7BsB,CA8BtB;;AACA1D,MAAAA,EAAE,CAACqD,QAAH,CAAYG,QAAZ,CAAqBqF,IAArB,CAA0BnI,IAA1B;AACA,aAAOA,IAAP;AACH;;AACD,WAAO,IAAP;AACH,GA5SI;AA8SL;AACAsD,EAAAA,SAAS,EAAE,mBAAS8E,EAAT,EAAab,IAAb,EAAmB;AAC1B,QAAG,KAAK7E,QAAL,CAAc8E,IAAd,KAAqB,CAArB,IAA0B,KAAKtH,QAAL,GAAgB,CAA7C,EAA+C;AAC3C,UAAIF,IAAI,GAAG,KAAK0C,QAAL,CAAc+E,GAAd,EAAX;AACA,UAAIY,KAAK,GAAG9B,QAAQ,CAAC+B,IAAI,CAACC,MAAL,KAAc,CAAf,EAAkB,EAAlB,CAApB,CAF2C,CAG3C;;AACA,UAAItB,QAAQ,GAAGjH,IAAI,CAACkB,YAAL,CAAkB,YAAlB,CAAf,CAJ2C,CAK3C;;AACAlB,MAAAA,IAAI,CAACkB,YAAL,CAAkB5B,EAAE,CAACoI,MAArB,EAA6BC,WAA7B,GAA2C,KAAKrH,YAAL,CAAkB+H,KAAlB,CAA3C;AACArI,MAAAA,IAAI,CAAC4H,QAAL,GAAgB,KAAKxH,SAAL,CAAeiI,KAAf,CAAhB;AAEApB,MAAAA,QAAQ,CAAC7H,QAAT,GAAoBiJ,KAApB;AACApB,MAAAA,QAAQ,CAACa,KAAT,GAAiB,KAAKtH,UAAL,CAAgB6H,KAAhB,CAAjB;AACApB,MAAAA,QAAQ,CAACc,QAAT,GAAoB,KAAKrH,aAAL,CAAmB2H,KAAnB,CAApB;AACApB,MAAAA,QAAQ,CAACe,KAAT,GAAiB,KAAKrH,UAAL,CAAgB0H,KAAhB,CAAjB;AACApB,MAAAA,QAAQ,CAACgB,GAAT,GAAe,KAAf;;AAEA,UAAG,CAACV,IAAJ,EAAS;AACL,YAAGjI,EAAE,CAACqD,QAAH,CAAYE,MAAf,EAAsB;AAClB;AACAoE,UAAAA,QAAQ,CAACM,IAAT,GAAgB,CAAhB;AACH,SAHD,MAGM;AACF;AACAN,UAAAA,QAAQ,CAACM,IAAT,GAAgB,EAAEjI,EAAE,CAACqD,QAAH,CAAYC,MAA9B;AACH;AACJ,OARD,MAQM;AACF;AACAqE,QAAAA,QAAQ,CAACM,IAAT,GAAgBA,IAAhB;AACH;;AAED,UAAGc,KAAK,IAAI,CAAZ,EAAc;AACVrI,QAAAA,IAAI,CAAC0D,KAAL,GAAa,EAAb;AACH,OAFD,MAEM,IAAG2E,KAAK,IAAI,CAAZ,EAAc;AAChBrI,QAAAA,IAAI,CAAC0D,KAAL,GAAa,GAAb;AACH,OAFK,MAEA,IAAG2E,KAAK,IAAI,CAAZ,EAAc;AAChBrI,QAAAA,IAAI,CAAC0D,KAAL,GAAa,GAAb;AACH;;AACD,UAAGuD,QAAQ,CAACuB,aAAT,CAAuBxI,IAAI,CAACyI,cAAL,EAAvB,CAAH,EAAiD;AAC7C,aAAI,IAAIlG,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,KAAKnC,SAAL,CAAe4G,MAAf,GAAsB,CAArC,EAAwCzE,CAAC,EAAzC,EAA4C;AACxCvC,UAAAA,IAAI,CAAC4H,QAAL,GAAgB,KAAKxH,SAAL,CAAemC,CAAf,CAAhB;;AACA,cAAG,CAAC0E,QAAQ,CAACuB,aAAT,CAAuBxI,IAAI,CAACyI,cAAL,EAAvB,CAAJ,EAAkD;AAC9C;AACH;AACJ;AACJ;;AAEDzI,MAAAA,IAAI,CAACkI,MAAL,GAAc,KAAKlF,QAAnB,CA5C2C,CA6C3C;;AACA1D,MAAAA,EAAE,CAACqD,QAAH,CAAYG,QAAZ,CAAqBqF,IAArB,CAA0BnI,IAA1B;AACA,WAAKE,QAAL;AACH;AACJ,GAjWI;AAmWLwI,EAAAA,QAAQ,EAAE,kBAAS1I,IAAT,EAAe;AACrBA,IAAAA,IAAI,CAACkI,MAAL,GAAc,IAAd;AACAlI,IAAAA,IAAI,CAACkB,YAAL,CAAkB,YAAlB,EAAgC+G,GAAhC,GAAsC,IAAtC;AACA,SAAKvF,QAAL,CAAcD,GAAd,CAAkBzC,IAAlB;;AACA,QAAGV,EAAE,CAACqD,QAAH,CAAYE,MAAZ,IAAsB7C,IAAI,CAACkB,YAAL,CAAkB,YAAlB,EAAgCqG,IAAhC,IAAwC,CAAjE,EAAmE;AAC/D;AACA,WAAKpH,IAAL;AACA,WAAKY,OAAL,CAAaK,MAAb,GAAsB,KAAKjB,IAAL,GAAY,EAAlC;;AAEA,UAAG,KAAKA,IAAL,GAAY,CAAf,EAAiB;AACb,aAAKgD,aAAL;AACH,OAFD,MAEK;AACD,aAAK4D,QAAL;AACH;AACJ,KAVD,MAWI;AACA,UAAI4B,OAAO,GAAGC,MAAM,CAAC,KAAK/H,QAAL,CAAcO,MAAf,CAAN,GAA+B,CAA7C;AACA,WAAKP,QAAL,CAAcO,MAAd,GAAuBuH,OAAO,GAAG,EAAjC;;AACA,UAAGA,OAAO,IAAI,CAAd,EAAgB;AACZtJ,QAAAA,KAAK,CAAC8H,IAAN,CAAWC,IAAX,CAAgB,IAAhB,EAAsB,KAAtB,EAA6B,YAAY;AACrC9H,UAAAA,EAAE,CAAC+H,QAAH,CAAYC,SAAZ,CAAsB,YAAtB;AACH,SAFD;AAGH;AACJ;AACJ,GA3XI;AA6XL;AACA3C,EAAAA,YAAY,EAAE,wBAAU;AACpB,QAAG,KAAKvB,eAAL,CAAqByF,SAArB,CAA+B,KAAKzG,UAApC,CAAH,EAAmD;AAC/C;AACA9C,MAAAA,EAAE,CAACwJ,WAAH,CAAeC,IAAf,CAAoB,KAAK3F,eAAL,CAAqB4F,UAAzC,EAAqD,KAArD,EAA4D,CAA5D;AACH;AACJ,GAnYI;AAqYL;AACAC,EAAAA,SAAS,EAAE,qBAAY;AACnB,SAAKC,UAAL,CAAgB,KAAK5F,SAArB,EAA+B,IAA/B;AACH;AAxYI,CAAT","sourceRoot":"/","sourcesContent":["var TankType = require(\"TankData\").tankType;\nlet alert = require('Alert');\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        //地图\n        curMap: cc.TiledMap,\n        //摇杆\n        yaogan: cc.Node,\n\n        //子弹预制体\n        bullet: cc.Prefab,\n        //坦克预制体\n        tank: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //最大数量\n        maxCount: 5,\n        life: 3,\n        //出生地\n        bornPoses: {\n            default: [],\n            type: cc.Vec2,\n        },\n        //坦克皮肤\n        spriteFrames: {\n            default: [],\n            type: cc.SpriteFrame,\n        },\n        //坦克移动速度\n        tankSpeeds: {\n            default: [],\n            type: cc.Float,\n        },\n        //坦克子弹发射间隔时间\n        tankFireTimes: {\n            default: [],\n            type: cc.Float,\n        },\n\n        //坦克血量\n        tankBloods: {\n            default: [],\n            type: cc.Integer,\n        },\n        \n        enemyNum: {\n            type: cc.Label,\n            default: null,\n        },\n        lifeNum: {\n            type: cc.Label,\n            default: null,\n        },\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // cc.director.setDisplayStats(true);\n        //获取摇杆控制组件\n        this._joystickCtrl = this.yaogan.getComponent(\"JoystickCtrl\");\n        //获取地图 TiledMap 组件\n        this._tiledMap = this.curMap.getComponent('cc.TiledMap');\n        this.enemyNum.string = this.maxCount + \"\";\n        this.lifeNum.string = this.life + \"\";\n    },\n\n    start: function(err){\n        if(err){\n            return;\n        }\n\n        //默认角度\n        this.curAngle = null;\n\n        var self = this;\n        //注册监听事件\n        this.registerInputEvent();\n        //引入地图数据\n        this._tiledMapData = require(\"TiledMapData\");\n\n        //获取地图尺寸\n        this._curMapTileSize = this._tiledMap.getTileSize();\n        this._curMapSize = cc.v2(this._tiledMap.node.width,this._tiledMap.node.height);\n        \n        //地图墙层\n        this.mapLayer0 = this._tiledMap.getLayer(\"layer_0\");\n\n        //初始化对象池(参数必须为对应脚本的文件名)\n        this.bulletPool = new cc.NodePool(\"BulletScript\");\n        var initBulletCount = 20;\n        for(var i=0; i<initBulletCount; ++i){\n            var bullet = cc.instantiate(this.bullet);\n            this.bulletPool.put(bullet);\n        }\n        this.tankPool = new cc.NodePool(\"TankScript\");\n        for(var i=0; i<this.maxCount; ++i){\n            var tank = cc.instantiate(this.tank);\n            this.tankPool.put(tank);\n        }\n        if(!cc.gameData){\n            cc.gameData = {};\n        }\n        //初始化\n        cc.gameData.teamId = 0;\n        //临时\n        cc.gameData.single = true;\n\n        //地图内坦克列表\n        cc.gameData.tankList = [];\n        //地图内子弹列表\n        cc.gameData.bulletList = [];\n\n        //获取组件\n        this.tankNode = cc.find(\"/Canvas/Map/tank\");\n        //加入player\n        this.player = this.addPlayerTank();\n        //获取坦克控制组件\n        this._playerTankCtrl = this.player.getComponent(\"TankScript\"); \n\n        //启动定时器，添加坦克\n        this.schedule(this.addAITank,3,cc.macro.REPEAT_FOREVER,1);\n        \n    },\n\n    //注册输入事件\n    registerInputEvent: function () {\n\n        var self = this;\n\n        this._joystickCtrl.addJoyStickTouchChangeListener(function (angle) {\n            \n            if(angle == self.curAngle &&\n                !self._playerTankCtrl.stopMove ){\n                return;\n            }\n            self.curAngle = angle;\n\n            if(angle!=null){\n                //开始前进\n                self._playerTankCtrl.tankMoveStart(angle);\n            }else {\n                //停止前进\n                self._playerTankCtrl.tankMoveStop();\n            }\n\n        });\n        //按键按下\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, \n                        function (event) {\n                            var angle = null;\n                            switch(event.keyCode) {\n                                case cc.macro.KEY.w:\n                                    angle = 90;\n                                    break;\n                                case cc.macro.KEY.s:\n                                    angle = 270;\n                                    break;\n                                case cc.macro.KEY.a:\n                                    angle = 180;\n                                    break;\n                                case cc.macro.KEY.d:\n                                    angle = 0;\n                                    break;\n                            }\n                            if(event.keyCode == cc.macro.KEY.k){\n                                this.fireBtnClick();\n                            }else {\n                                self._playerTankCtrl.tankMoveStop();\n                            }\n                            if(angle!=null){\n                                //开始前进\n                                self._playerTankCtrl.tankMoveStart(angle);\n                            }\n                        }, this);\n        //按键抬起\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, \n                        function (event){\n                            //停止前进\n                            if(event.keyCode != cc.macro.KEY.k){\n                                self._playerTankCtrl.tankMoveStop();\n                            }\n                        }, this);\n\n    },\n\n    //碰撞检测\n    collisionTest: function(rect, bullet){\n        //判断是否碰到地图边界\n        if (rect.xMin <= -this._curMapSize.x/2 || rect.xMax >= this._curMapSize.x/2 ||\n\t\t    rect.yMin <= -this._curMapSize.y/2 || rect.yMax >= this._curMapSize.y/2){\n                \n            return true;\n        }\n        //判断是否撞墙\n        //将坐标转换为地图坐标系\n        var MinY = this._curMapSize.y/2 - rect.yMin;\n\t    var MaxY = this._curMapSize.y/2 - rect.yMax;\n        var MinX = this._curMapSize.x/2 + rect.xMin;\n        var MaxX = this._curMapSize.x/2 + rect.xMax;\n\n        //获取四个角的顶点\n        var LeftDown = cc.v2(MinX, MinY);\n        var RightDown = cc.v2(MaxX, MinY);\n        var LeftUp = cc.v2(MinX, MaxY);\n        var RightUp = cc.v2(MaxX, MaxY);\n\n        //获取四条边的中心点\n        var MidDown = cc.v2(MinX+(MaxX-MinX)/2, MinY);\n        var MidUp = cc.v2(MinX+(MaxX-MinX)/2, MaxY);\n        var MidLeft = cc.v2(MinX, MinY+(MaxY-MinY)/2);\n        var MidRight= cc.v2(MaxX, MinY+(MaxY-MinY)/2);\n\n        //检测碰撞\n        return this._collisionTest([LeftDown,RightDown,LeftUp,RightUp,\n                        MidDown,MidUp,MidLeft,MidRight],\n                        bullet);\n    },\n\n    //内部碰撞检测方法\n    _collisionTest: function(points, bullet){\n        var point = points.shift()\n        var gid = this.mapLayer0.getTileGIDAt(cc.v2(parseInt(point.x / this._curMapTileSize.width),parseInt(point.y / this._curMapTileSize.height)));\n\n        if (this._tiledMapData.gidToTileType[gid] != this._tiledMapData.tileType.tileNone && \n            this._tiledMapData.gidToTileType[gid] != this._tiledMapData.tileType.tileGrass){\n            if(bullet && this._tiledMapData.gidToTileType[gid] == this._tiledMapData.tileType.tileWall){\n                this.mapLayer0.setTileGIDAt(0, parseInt(point.x / this._curMapTileSize.width),parseInt(point.y / this._curMapTileSize.height), 1);\n            }\n            else if(bullet && this._tiledMapData.gidToTileType[gid] == this._tiledMapData.tileType.tileKing){\n                \n                this.mapLayer0.setTileGIDAt(0, 12, 25, 1);\n                this.mapLayer0.setTileGIDAt(0, 12, 24, 1);\n                this.mapLayer0.setTileGIDAt(0, 13, 25, 1);\n                this.mapLayer0.setTileGIDAt(0, 13, 24, 1);\n\n                this.gameOver();\n            }\n            return true;\n        }\n        if(points.length>0){\n            return this._collisionTest(points, bullet);\n        }else{\n            return false;\n        }\n    },\n\n    gameOver: function(){\n\n        for(var i=0; i<cc.gameData.tankList.length; i++){\n            var tank = cc.gameData.tankList[i]\n            var tankCtrl = tank.getComponent(\"TankScript\");\n            tankCtrl.tankStop();\n        }\n\n        //弹窗调用\n        alert.show.call(this, \"游戏结束\", function () {\n            cc.director.loadScene(\"StartScene\");\n        });\n    },\n\n    //加入玩家坦克\n    addPlayerTank: function(team) {\n        if(this.tankPool.size()>0){\n            var tank = this.tankPool.get();\n            tank.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[this.spriteFrames.length-1];\n            tank.position = this.bornPoses[this.bornPoses.length-1];\n            //获取坦克控制组件\n            var tankCtrl = tank.getComponent(\"TankScript\");\n            //设置坦克属性\n            tankCtrl.tankType = TankType.Player;\n            tankCtrl.speed = this.tankSpeeds[this.tankSpeeds.length-1];\n            tankCtrl.fireTime = this.tankFireTimes[this.tankFireTimes.length-1];\n            //tankCtrl.blood = this.tankBloods[this.tankBloods.length-1];\n            //tankCtrl.blood = this.life ;\n            tankCtrl.blood = 1;\n            tankCtrl.die = false;\n            \n            if(!team){\n                if(cc.gameData.single){\n                    //单机版\n                    tankCtrl.team = 0;\n                }else {\n                    //大乱斗\n                    tankCtrl.team = ++cc.gameData.teamId;\n                }\n                \n            }else {\n                //组队\n                tankCtrl.team = team;\n            }\n\n            tank.parent = this.tankNode;\n            //加到列表\n            cc.gameData.tankList.push(tank);\n            return tank;\n        }\n        return null;\n    },\n\n    //加入AI\n    addAITank: function(dt, team) {\n        if(this.tankPool.size()>0 && this.maxCount > 0){\n            var tank = this.tankPool.get();\n            var index = parseInt(Math.random()*3, 10);\n            //获取坦克控制组件\n            var tankCtrl = tank.getComponent(\"TankScript\");\n            //设置坦克属性\n            tank.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[index];\n            tank.position = this.bornPoses[index];\n\n            tankCtrl.tankType = index;\n            tankCtrl.speed = this.tankSpeeds[index];\n            tankCtrl.fireTime = this.tankFireTimes[index];\n            tankCtrl.blood = this.tankBloods[index];\n            tankCtrl.die = false;\n\n            if(!team){\n                if(cc.gameData.single){\n                    //单机版\n                    tankCtrl.team = 1;\n                }else {\n                    //大乱斗\n                    tankCtrl.team = ++cc.gameData.teamId;\n                }\n            }else {\n                //组队\n                tankCtrl.team = team;\n            }\n\n            if(index == 0){\n                tank.angle = 90;\n            }else if(index == 1){\n                tank.angle = 180;\n            }else if(index == 2){\n                tank.angle = 270;\n            }\n            if(tankCtrl.collisionTank(tank.getBoundingBox())){\n                for(var i=0; i<this.bornPoses.length-1; i++){\n                    tank.position = this.bornPoses[i];\n                    if(!tankCtrl.collisionTank(tank.getBoundingBox())){\n                        break;\n                    }\n                }\n            }\n\n            tank.parent = this.tankNode;\n            //加到列表\n            cc.gameData.tankList.push(tank);\n            this.maxCount --;\n        }\n    },\n\n    tankBoom: function(tank) {\n        tank.parent = null;\n        tank.getComponent(\"TankScript\").die = true;\n        this.tankPool.put(tank);\n        if(cc.gameData.single && tank.getComponent(\"TankScript\").team == 0){\n            //cc.director.loadScene(\"StartScene\");\n            this.life --;\n            this.lifeNum.string = this.life + \"\";\n\n            if(this.life > 0){\n                this.addPlayerTank();\n            }else{\n                this.gameOver();\n            }\n        }\n        else{\n            var tankNum = Number(this.enemyNum.string) - 1;\n            this.enemyNum.string = tankNum + \"\";\n            if(tankNum == 0){\n                alert.show.call(this, \"你赢了\", function () {\n                    cc.director.loadScene(\"StartScene\");\n                });\n            }\n        }\n    },\n\n    //开火按钮点击\n    fireBtnClick: function(){\n        if(this._playerTankCtrl.startFire(this.bulletPool)){\n            //播放射击音效\n            cc.audioEngine.play(this._playerTankCtrl.shootAudio, false, 1);\n        }\n    },\n\n    //销毁时调用\n    onDestroy: function () {\n        this.unschedule(this.addAITank,this);\n    },\n});\n"]}