
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/TankScript.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6ce61tIUVFH+4QczJMrP1cD', 'TankScript');
// scripts/TankScript.js

"use strict";

var TankType = require("TankData").tankType;

cc.Class({
  "extends": cc.Component,
  properties: {
    //坦克类型
    tankType: {
      "default": TankType.Normal,
      type: TankType
    },
    //速度
    speed: 20,
    //子弹
    bullet: cc.Prefab,
    //发射子弹间隔时间
    fireTime: 0.5,
    //血量
    blood: 1,
    //所属组织
    team: 0,
    //爆炸动画
    blast: cc.Prefab,
    //射击音效
    shootAudio: {
      "default": null,
      url: cc.AudioClip
    },
    //坦克皮肤
    spriteFrames: {
      "default": [],
      type: cc.SpriteFrame
    },
    die: false,
    stop: false
  },
  // use this for initialization
  onLoad: function onLoad() {
    //获取组件
    this._cityCtrl = cc.find("/CityScript").getComponent("CityScript");
    this.bulletNode = cc.find("/Canvas/Map/layer_0"); //this.bulletNode = cc.find("/Canvas/map1/layer0");
  },
  start: function start() {
    //初始是停止状态的
    this.stopMove = true;
    this.stop = false; //偏移量

    this.offset = cc.v2();

    if (this.tankType != TankType.Player) {
      var self = this; //添加AI

      var callback = cc.callFunc(function () {
        var angles = [0, 90, 180, 270];
        var index = parseInt(Math.random() * 4, 10);
        self.tankMoveStart(angles[index]);
        self.startFire(self._cityCtrl.bulletPool);
      }, this);
      var seq = cc.sequence(cc.delayTime(0.3), callback, cc.delayTime(1));
      this.node.runAction(cc.repeatForever(seq));
    }
  },
  //添加坦克移动动作
  tankMoveStart: function tankMoveStart(angle) {
    this.node.angle = angle - 90;

    if (angle == 0 || angle == 180 || angle == 90) {
      this.offset = cc.v2(Math.floor(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else if (angle == 270) {
      this.offset = cc.v2(Math.ceil(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else {
      this.offset = cc.v2(Math.cos(Math.PI / 180 * angle), Math.sin(Math.PI / 180 * angle));
    }

    this.stopMove = false;
  },
  //移除坦克移动动作
  tankMoveStop: function tankMoveStop() {
    this.stopMove = true;
  },
  tankStop: function tankStop() {
    this.stop = true;
    cc.director.getActionManager().pauseAllRunningActions();
  },
  // called every frame, uncomment this function to activate update callback
  update: function update(dt) {
    if (this.stop) {
      return;
    }

    if (!this.stopMove) {
      var boundingBox = this.node.getBoundingBox();
      var rect = cc.rect(boundingBox.xMin + this.offset.x * this.speed * dt * 1.5, boundingBox.yMin + this.offset.y * this.speed * dt * 1.7, boundingBox.size.width, boundingBox.size.height);

      if (this._cityCtrl.collisionTest(rect) //检测与地图的碰撞
      || this.collisionTank(rect)) {
        this.tankMoveStop();
      } else {
        this.node.x += this.offset.x * this.speed * dt;
        this.node.y += this.offset.y * this.speed * dt;
      }
    }

    if (this.stopFire) {
      this.fireTime -= dt;

      if (this.fireTime <= 0) {
        this.stopFire = false;
      }
    }
  },
  //判断是否与其他坦克碰撞
  collisionTank: function collisionTank(rect) {
    for (var i = 0; i < cc.gameData.tankList.length; i++) {
      var tank = cc.gameData.tankList[i];

      if (this.node === tank) {
        continue;
      }

      var boundingBox = tank.getBoundingBox(); // if(cc.rectIntersectsRect(rect, boundingBox)){

      if (rect.intersects(boundingBox)) {
        return true;
      }
    }

    return false;
  },
  //开火
  startFire: function startFire(bulletPool) {
    if (this.stopFire) {
      return false;
    }

    this.stopFire = true;
    this.fireTime = 0.5;
    var bullet = null;

    if (bulletPool.size() > 0) {
      bullet = bulletPool.get(bulletPool);
    } else {
      bullet = cc.instantiate(this.bullet);
    } //设置子弹位置,角度


    bullet.angle = this.node.angle;
    var pos = this.node.position;
    var angle = this.node.angle - 90;
    var offset = cc.v2(0, 0);

    if (angle == 0 || angle == 180 || angle == 90) {
      offset = cc.v2(Math.floor(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else if (angle == 270) {
      offset = cc.v2(Math.ceil(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else {
      offset = cc.v2(Math.cos(Math.PI / 180 * angle), Math.sin(Math.PI / 180 * angle));
    }

    if (angle == -90) {
      //cc.log("上");
      bullet.position = pos.add(cc.v2(10 * offset.x, 10 * offset.y + 15));
    } else if (angle == 0) {
      //cc.log("左");
      bullet.position = pos.add(cc.v2(10 * offset.x - 15, 10 * offset.y));
    } else if (angle == -180) {
      //cc.log("右");
      bullet.position = pos.add(cc.v2(10 * offset.x + 15, 10 * offset.y));
    } else if (angle == 90) {
      //cc.log("下");
      bullet.position = pos.add(cc.v2(10 * offset.x, 10 * offset.y - 15));
    } // bullet.position = cc.pAdd(pos,cc.v2(10*offset.x, 10*offset.y));


    bullet.getComponent("BulletScript").bulletMove();
    bullet.parent = this.bulletNode; //子弹标记

    bullet.camp = this.team; //加到列表

    cc.gameData.bulletList.push(bullet);
    return true;
  },
  //爆炸
  boom: function boom() {
    var blast = cc.instantiate(this.blast);
    blast.parent = this.node.parent;
    blast.position = this.node.position;
    var anim = blast.getComponent(cc.Animation);
    anim.play();

    this._cityCtrl.tankBoom(this.node);
  },
  turnGreen: function turnGreen(index) {
    //this.node.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[index];
    if (index == 0) {
      this.node.opacity = 55;
    } else {
      this.node.opacity = 255;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcVGFua1NjcmlwdC5qcyJdLCJuYW1lcyI6WyJUYW5rVHlwZSIsInJlcXVpcmUiLCJ0YW5rVHlwZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiTm9ybWFsIiwidHlwZSIsInNwZWVkIiwiYnVsbGV0IiwiUHJlZmFiIiwiZmlyZVRpbWUiLCJibG9vZCIsInRlYW0iLCJibGFzdCIsInNob290QXVkaW8iLCJ1cmwiLCJBdWRpb0NsaXAiLCJzcHJpdGVGcmFtZXMiLCJTcHJpdGVGcmFtZSIsImRpZSIsInN0b3AiLCJvbkxvYWQiLCJfY2l0eUN0cmwiLCJmaW5kIiwiZ2V0Q29tcG9uZW50IiwiYnVsbGV0Tm9kZSIsInN0YXJ0Iiwic3RvcE1vdmUiLCJvZmZzZXQiLCJ2MiIsIlBsYXllciIsInNlbGYiLCJjYWxsYmFjayIsImNhbGxGdW5jIiwiYW5nbGVzIiwiaW5kZXgiLCJwYXJzZUludCIsIk1hdGgiLCJyYW5kb20iLCJ0YW5rTW92ZVN0YXJ0Iiwic3RhcnRGaXJlIiwiYnVsbGV0UG9vbCIsInNlcSIsInNlcXVlbmNlIiwiZGVsYXlUaW1lIiwibm9kZSIsInJ1bkFjdGlvbiIsInJlcGVhdEZvcmV2ZXIiLCJhbmdsZSIsImZsb29yIiwiY29zIiwiUEkiLCJzaW4iLCJjZWlsIiwidGFua01vdmVTdG9wIiwidGFua1N0b3AiLCJkaXJlY3RvciIsImdldEFjdGlvbk1hbmFnZXIiLCJwYXVzZUFsbFJ1bm5pbmdBY3Rpb25zIiwidXBkYXRlIiwiZHQiLCJib3VuZGluZ0JveCIsImdldEJvdW5kaW5nQm94IiwicmVjdCIsInhNaW4iLCJ4IiwieU1pbiIsInkiLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJjb2xsaXNpb25UZXN0IiwiY29sbGlzaW9uVGFuayIsInN0b3BGaXJlIiwiaSIsImdhbWVEYXRhIiwidGFua0xpc3QiLCJsZW5ndGgiLCJ0YW5rIiwiaW50ZXJzZWN0cyIsImdldCIsImluc3RhbnRpYXRlIiwicG9zIiwicG9zaXRpb24iLCJhZGQiLCJidWxsZXRNb3ZlIiwicGFyZW50IiwiY2FtcCIsImJ1bGxldExpc3QiLCJwdXNoIiwiYm9vbSIsImFuaW0iLCJBbmltYXRpb24iLCJwbGF5IiwidGFua0Jvb20iLCJ0dXJuR3JlZW4iLCJvcGFjaXR5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLElBQUlBLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQkMsUUFBbkM7O0FBRUFDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUVSO0FBQ0FKLElBQUFBLFFBQVEsRUFBRTtBQUNOLGlCQUFTRixRQUFRLENBQUNPLE1BRFo7QUFFTkMsTUFBQUEsSUFBSSxFQUFFUjtBQUZBLEtBSEY7QUFPUjtBQUNBUyxJQUFBQSxLQUFLLEVBQUUsRUFSQztBQVNSO0FBQ0FDLElBQUFBLE1BQU0sRUFBRVAsRUFBRSxDQUFDUSxNQVZIO0FBV1I7QUFDQUMsSUFBQUEsUUFBUSxFQUFFLEdBWkY7QUFhUjtBQUNBQyxJQUFBQSxLQUFLLEVBQUUsQ0FkQztBQWVSO0FBQ0FDLElBQUFBLElBQUksRUFBRSxDQWhCRTtBQWlCUjtBQUNBQyxJQUFBQSxLQUFLLEVBQUVaLEVBQUUsQ0FBQ1EsTUFsQkY7QUFtQlI7QUFDQUssSUFBQUEsVUFBVSxFQUFFO0FBQ1IsaUJBQVMsSUFERDtBQUVSQyxNQUFBQSxHQUFHLEVBQUVkLEVBQUUsQ0FBQ2U7QUFGQSxLQXBCSjtBQXdCUjtBQUNBQyxJQUFBQSxZQUFZLEVBQUU7QUFDVixpQkFBUyxFQURDO0FBRVZYLE1BQUFBLElBQUksRUFBRUwsRUFBRSxDQUFDaUI7QUFGQyxLQXpCTjtBQThCUkMsSUFBQUEsR0FBRyxFQUFFLEtBOUJHO0FBK0JSQyxJQUFBQSxJQUFJLEVBQUU7QUEvQkUsR0FIUDtBQXNDTDtBQUNBQyxFQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDaEI7QUFDQSxTQUFLQyxT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QUFDVyxZQUFOLENBQW1CdkIsRUFBRSxDQUFDMkYsU0FBdEIsQ0FBWDtBQUNBRCxJQUFBQSxJQUFJLENBQUNFLElBQUw7O0FBQ0EsU0FBS3ZFLFNBQUwsQ0FBZXdFLFFBQWYsQ0FBd0IsS0FBS2pELElBQTdCO0FBQ0gsR0F2Tkk7QUF5TkxrRCxFQUFBQSxTQUFTLEVBQUUsbUJBQVM1RCxLQUFULEVBQWU7QUFDdEI7QUFDQSxRQUFHQSxLQUFLLElBQUksQ0FBWixFQUFjO0FBQ1YsV0FBS1UsSUFBTCxDQUFVbUQsT0FBVixHQUFvQixFQUFwQjtBQUNILEtBRkQsTUFFSztBQUNELFdBQUtuRCxJQUFMLENBQVVtRCxPQUFWLEdBQW9CLEdBQXBCO0FBQ0g7QUFDSjtBQWhPSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcclxudmFyIFRhbmtUeXBlID0gcmVxdWlyZShcIlRhbmtEYXRhXCIpLnRhbmtUeXBlO1xyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuXHJcbiAgICAgICAgLy/lnablhYvnsbvlnotcclxuICAgICAgICB0YW5rVHlwZToge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBUYW5rVHlwZS5Ob3JtYWwsXHJcbiAgICAgICAgICAgIHR5cGU6IFRhbmtUeXBlXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgLy/pgJ/luqZcclxuICAgICAgICBzcGVlZDogMjAsXHJcbiAgICAgICAgLy/lrZDlvLlcclxuICAgICAgICBidWxsZXQ6IGNjLlByZWZhYixcclxuICAgICAgICAvL+WPkeWwhOWtkOW8uemXtOmalOaXtumXtFxyXG4gICAgICAgIGZpcmVUaW1lOiAwLjUsXHJcbiAgICAgICAgLy/ooYDph49cclxuICAgICAgICBibG9vZDogMSxcclxuICAgICAgICAvL+aJgOWxnue7hOe7h1xyXG4gICAgICAgIHRlYW06IDAsXHJcbiAgICAgICAgLy/niIbngrjliqjnlLtcclxuICAgICAgICBibGFzdDogY2MuUHJlZmFiLFxyXG4gICAgICAgIC8v5bCE5Ye76Z+z5pWIXHJcbiAgICAgICAgc2hvb3RBdWRpbzoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICB1cmw6IGNjLkF1ZGlvQ2xpcCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8v5Z2m5YWL55qu6IKkXHJcbiAgICAgICAgc3ByaXRlRnJhbWVzOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IFtdLFxyXG4gICAgICAgICAgICB0eXBlOiBjYy5TcHJpdGVGcmFtZSxcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBkaWU6IGZhbHNlLFxyXG4gICAgICAgIHN0b3A6IGZhbHNlLFxyXG5cclxuICAgIH0sXHJcblxyXG4gICAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXHJcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL+iOt+WPlue7hOS7tlxyXG4gICAgICAgIHRoaXMuX2NpdHlDdHJsID0gY2MuZmluZChcIi9DaXR5U2NyaXB0XCIpLmdldENvbXBvbmVudChcIkNpdHlTY3JpcHRcIik7XHJcbiAgICAgICAgdGhpcy5idWxsZXROb2RlID0gY2MuZmluZChcIi9DYW52YXMvTWFwL2xheWVyXzBcIik7XHJcbiAgICAgICAgLy90aGlzLmJ1bGxldE5vZGUgPSBjYy5maW5kKFwiL0NhbnZhcy9tYXAxL2xheWVyMFwiKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8v5Yid5aeL5piv5YGc5q2i54q25oCB55qEXHJcbiAgICAgICAgdGhpcy5zdG9wTW92ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zdG9wID0gZmFsc2U7XHJcbiAgICAgICAgLy/lgY/np7vph49cclxuICAgICAgICB0aGlzLm9mZnNldCA9IGNjLnYyKCk7XHJcblxyXG4gICAgICAgIGlmKHRoaXMudGFua1R5cGUgIT0gVGFua1R5cGUuUGxheWVyKXtcclxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAvL+a3u+WKoEFJXHJcbiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGNjLmNhbGxGdW5jKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5nbGVzID0gWzAsIDkwLCAxODAsIDI3MF07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBwYXJzZUludChNYXRoLnJhbmRvbSgpKjQsIDEwKTtcclxuICAgICAgICAgICAgICAgIHNlbGYudGFua01vdmVTdGFydChhbmdsZXNbaW5kZXhdKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0RmlyZShzZWxmLl9jaXR5Q3RybC5idWxsZXRQb29sKTtcclxuXHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNlcSA9IGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgwLjMpLCBjYWxsYmFjaywgY2MuZGVsYXlUaW1lKDEpKTtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihjYy5yZXBlYXRGb3JldmVyKHNlcSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9LFxyXG5cclxuICAgIC8v5re75Yqg5Z2m5YWL56e75Yqo5Yqo5L2cXHJcbiAgICB0YW5rTW92ZVN0YXJ0OiBmdW5jdGlvbiAoYW5nbGUpIHtcclxuXHJcbiAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gYW5nbGUgLSA5MDtcclxuXHJcbiAgICAgICAgaWYoYW5nbGU9PTAgfHwgYW5nbGU9PTE4MCB8fCBhbmdsZT09OTApe1xyXG4gICAgICAgICAgICB0aGlzLm9mZnNldCA9IGNjLnYyKE1hdGguZmxvb3IoTWF0aC5jb3MoTWF0aC5QSS8xODAqYW5nbGUpKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKSk7XHJcbiAgICAgICAgfWVsc2UgaWYoYW5nbGU9PTI3MCl7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9mZnNldCA9IGNjLnYyKE1hdGguY2VpbChNYXRoLmNvcyhNYXRoLlBJLzE4MCphbmdsZSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKSk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm9mZnNldCA9IGNjLnYyKE1hdGguY29zKE1hdGguUEkvMTgwKmFuZ2xlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbihNYXRoLlBJLzE4MCphbmdsZSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zdG9wTW92ZSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICAvL+enu+mZpOWdpuWFi+enu+WKqOWKqOS9nFxyXG4gICAgdGFua01vdmVTdG9wOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5zdG9wTW92ZSA9IHRydWU7XHJcbiAgICB9LFxyXG5cclxuICAgIHRhbmtTdG9wOiBmdW5jdGlvbiAoKXtcclxuICAgICAgICB0aGlzLnN0b3AgPSB0cnVlO1xyXG4gICAgICAgIGNjLmRpcmVjdG9yLmdldEFjdGlvbk1hbmFnZXIoKS5wYXVzZUFsbFJ1bm5pbmdBY3Rpb25zKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8vIGNhbGxlZCBldmVyeSBmcmFtZSwgdW5jb21tZW50IHRoaXMgZnVuY3Rpb24gdG8gYWN0aXZhdGUgdXBkYXRlIGNhbGxiYWNrXHJcbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xyXG5cclxuICAgICAgICBpZih0aGlzLnN0b3Ape1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZighdGhpcy5zdG9wTW92ZSl7XHJcbiAgICAgICAgICAgIHZhciBib3VuZGluZ0JveCA9IHRoaXMubm9kZS5nZXRCb3VuZGluZ0JveCgpO1xyXG4gICAgICAgICAgICB2YXIgcmVjdCA9IGNjLnJlY3QoYm91bmRpbmdCb3gueE1pbiArIHRoaXMub2Zmc2V0LngqdGhpcy5zcGVlZCpkdCoxLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZGluZ0JveC55TWluICsgdGhpcy5vZmZzZXQueSp0aGlzLnNwZWVkKmR0KjEuNywgXHJcblx0XHQgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94LnNpemUud2lkdGgsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRpbmdCb3guc2l6ZS5oZWlnaHQpO1xyXG4gICAgICAgICAgICBpZih0aGlzLl9jaXR5Q3RybC5jb2xsaXNpb25UZXN0KHJlY3QpIC8v5qOA5rWL5LiO5Zyw5Zu+55qE56Kw5pKeXHJcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmNvbGxpc2lvblRhbmsocmVjdClcclxuICAgICAgICAgICAgICAgICl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhbmtNb3ZlU3RvcCgpO1xyXG4gICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueCArPSB0aGlzLm9mZnNldC54KnRoaXMuc3BlZWQqZHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueSArPSB0aGlzLm9mZnNldC55KnRoaXMuc3BlZWQqZHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5zdG9wRmlyZSl7XHJcbiAgICAgICAgICAgIHRoaXMuZmlyZVRpbWUgLT0gZHQ7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZmlyZVRpbWU8PTApe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wRmlyZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcblxyXG4gICAgLy/liKTmlq3mmK/lkKbkuI7lhbbku5blnablhYvnorDmkp5cclxuICAgIGNvbGxpc2lvblRhbms6IGZ1bmN0aW9uKHJlY3QpIHtcclxuICAgICAgICBmb3IodmFyIGk9MDsgaTxjYy5nYW1lRGF0YS50YW5rTGlzdC5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIHZhciB0YW5rID0gY2MuZ2FtZURhdGEudGFua0xpc3RbaV1cclxuICAgICAgICAgICAgaWYodGhpcy5ub2RlID09PSB0YW5rKXtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBib3VuZGluZ0JveCA9IHRhbmsuZ2V0Qm91bmRpbmdCb3goKTtcclxuICAgICAgICAgICAgLy8gaWYoY2MucmVjdEludGVyc2VjdHNSZWN0KHJlY3QsIGJvdW5kaW5nQm94KSl7XHJcbiAgICAgICAgICAgIGlmKHJlY3QuaW50ZXJzZWN0cyhib3VuZGluZ0JveCkpeyAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIC8v5byA54GrXHJcbiAgICBzdGFydEZpcmU6IGZ1bmN0aW9uIChidWxsZXRQb29sKXtcclxuICAgICAgICBpZih0aGlzLnN0b3BGaXJlKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0b3BGaXJlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmZpcmVUaW1lID0gMC41O1xyXG5cclxuICAgICAgICB2YXIgYnVsbGV0ID0gbnVsbDtcclxuICAgICAgICBpZihidWxsZXRQb29sLnNpemUoKT4wKXtcclxuICAgICAgICAgICAgYnVsbGV0ID0gYnVsbGV0UG9vbC5nZXQoYnVsbGV0UG9vbCk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICBidWxsZXQgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmJ1bGxldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v6K6+572u5a2Q5by55L2N572uLOinkuW6plxyXG4gICAgICAgIGJ1bGxldC5hbmdsZSA9IHRoaXMubm9kZS5hbmdsZTtcclxuICAgICAgICB2YXIgcG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uO1xyXG5cclxuICAgICAgICB2YXIgYW5nbGUgPSB0aGlzLm5vZGUuYW5nbGUgLSA5MDtcclxuICAgICAgICB2YXIgb2Zmc2V0ID0gY2MudjIoMCwgMCk7XHJcbiAgICAgICAgaWYoYW5nbGU9PTAgfHwgYW5nbGU9PTE4MCB8fCBhbmdsZT09OTApe1xyXG4gICAgICAgICAgICBvZmZzZXQgPSBjYy52MihNYXRoLmZsb29yKE1hdGguY29zKE1hdGguUEkvMTgwKmFuZ2xlKSksIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKSk7XHJcbiAgICAgICAgfWVsc2UgaWYoYW5nbGU9PTI3MCl7XHJcbiAgICAgICAgICAgIG9mZnNldCA9IGNjLnYyKE1hdGguY2VpbChNYXRoLmNvcyhNYXRoLlBJLzE4MCphbmdsZSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKSk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICBvZmZzZXQgPSBjYy52MihNYXRoLmNvcyhNYXRoLlBJLzE4MCphbmdsZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKGFuZ2xlID09IC05MCl7XHJcbiAgICAgICAgICAgIC8vY2MubG9nKFwi5LiKXCIpO1xyXG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54LCAxMCpvZmZzZXQueSArIDE1KSk7XHJcbiAgICAgICAgfWVsc2UgaWYoYW5nbGUgPT0gMCl7XHJcbiAgICAgICAgICAgIC8vY2MubG9nKFwi5bemXCIpO1xyXG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54IC0gMTUsIDEwKm9mZnNldC55KSk7XHJcbiAgICAgICAgfWVsc2UgaWYoYW5nbGUgPT0gLTE4MCl7XHJcbiAgICAgICAgICAgIC8vY2MubG9nKFwi5Y+zXCIpO1xyXG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54ICsgMTUsIDEwKm9mZnNldC55KSk7XHJcbiAgICAgICAgfWVsc2UgaWYoYW5nbGUgPT0gOTApe1xyXG4gICAgICAgICAgICAvL2NjLmxvZyhcIuS4i1wiKTtcclxuICAgICAgICAgICAgYnVsbGV0LnBvc2l0aW9uID0gcG9zLmFkZChjYy52MigxMCpvZmZzZXQueCwgMTAqb2Zmc2V0LnkgLSAxNSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gYnVsbGV0LnBvc2l0aW9uID0gY2MucEFkZChwb3MsY2MudjIoMTAqb2Zmc2V0LngsIDEwKm9mZnNldC55KSk7XHJcblxyXG4gICAgICAgIGJ1bGxldC5nZXRDb21wb25lbnQoXCJCdWxsZXRTY3JpcHRcIikuYnVsbGV0TW92ZSgpO1xyXG4gICAgICAgIGJ1bGxldC5wYXJlbnQgPSB0aGlzLmJ1bGxldE5vZGU7XHJcbiAgICAgICAgLy/lrZDlvLnmoIforrBcclxuICAgICAgICBidWxsZXQuY2FtcCA9IHRoaXMudGVhbTtcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgLy/liqDliLDliJfooahcclxuICAgICAgICBjYy5nYW1lRGF0YS5idWxsZXRMaXN0LnB1c2goYnVsbGV0KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9LFxyXG5cclxuICAgIC8v54iG54K4XHJcbiAgICBib29tOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBibGFzdCA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYmxhc3QpO1xyXG4gICAgICAgIGJsYXN0LnBhcmVudCA9IHRoaXMubm9kZS5wYXJlbnQ7XHJcbiAgICAgICAgYmxhc3QucG9zaXRpb24gPSB0aGlzLm5vZGUucG9zaXRpb247XHJcbiAgICAgICAgdmFyIGFuaW0gPSBibGFzdC5nZXRDb21wb25lbnQoY2MuQW5pbWF0aW9uKTtcclxuICAgICAgICBhbmltLnBsYXkoKTtcclxuICAgICAgICB0aGlzLl9jaXR5Q3RybC50YW5rQm9vbSh0aGlzLm5vZGUpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0dXJuR3JlZW46IGZ1bmN0aW9uKGluZGV4KXtcclxuICAgICAgICAvL3RoaXMubm9kZS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuc3ByaXRlRnJhbWVzW2luZGV4XTtcclxuICAgICAgICBpZihpbmRleCA9PSAwKXtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLm9wYWNpdHkgPSA1NVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUub3BhY2l0eSA9IDI1NVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG59KTtcclxuIl19