{"version":3,"sources":["assets/joystick/scripts/JoystickCtrl.js"],"names":["TouchType","cc","Enum","DEFAULT","FOLLOW","DirectionType","FOUR","EIGHT","ALL","Class","Component","properties","joystickBar","type","Node","joystickBG","radius","touchType","directionType","curAngle","visible","distance","onLoad","width","registerInput","initPos","node","position","initBarPos","opacity","console","log","addJoyStickTouchChangeListener","callback","angleChange","self","on","EventType","TOUCH_START","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded","TOUCH_CANEL","test","event","getLocation","touchPos","parent","convertToNodeSpaceAR","setPosition","sub","Vec2","mag","_getAngle","x","Math","cos","_getRadian","y","sin","Vec3","point","_angle","floor","PI","_updateCurAngle","curZ","sqrt","pow","_radian","acos","_fourDirections","_eightDirections","onDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["\nvar TouchType = cc.Enum({\n    DEFAULT: 0,\n    FOLLOW: 1\n});\n\nvar DirectionType = cc.Enum({\n    FOUR: 0,\n    EIGHT: 1,\n    ALL: 2\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        joystickBar: {\n            default: null,\n            type: cc.Node\n        },//控杆\n        joystickBG: {\n            default: null,\n            type: cc.Node\n        },//控杆背景\n        radius: 0, //半径\n        touchType: {\n            default: TouchType.DEFAULT, //触摸类型\n            type: TouchType\n        },\n        directionType: {\n            default: DirectionType.ALL,  //方向类型\n            type: DirectionType\n        },\n        //当前角度\n        curAngle: {\n            default: 0,\n            visible: false\n        },\n        //当前距离\n        distance: {\n            default: 0,\n            visible: false\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if(this.radius == 0){\n            this.radius = this.joystickBG.width/2\n        }\n        this.registerInput()\n        this.distance = 0\n        this.curAngle = 0\n        this.initPos = this.node.position\n        this.initBarPos = this.joystickBar.position\n        \n        this.node.opacity = 50\n        console.log(\"joystickBar =\" + this.joystickBar);\n    },\n\n    addJoyStickTouchChangeListener: function(callback) {\n        this.angleChange = callback;\n    },\n\n    registerInput: function() {\n        var self = this;\n        // touch input\n        // this._listener = cc.eventManager.addListener({\n        //     event: cc.EventListener.TOUCH_ONE_BY_ONE,\n        //     onTouchBegan: function(touch, event) {\n        //         return self.onTouchBegan(touch, event)\n        //     },\n        //     onTouchMoved: function(touch, event) {\n        //         self.onTouchMoved(touch, event)\n        //     },\n        //     onTouchEnded: function(touch, event) {\n        //         self.onTouchEnded(touch, event)\n        //     }\n        // }, self.node);\n\n        // this.node.on(\"touchstart\", (touch) => {\n        //     console.log(\"touchstart\");\n        //     return self.onTouchBegan(touch);\n        // }, this);\n\n        // this.node.on(cc.node.EventType.TOUCH_START,this.onTouchBegan,this);\n        // this.node.on(cc.node.EventType.TOUCH_MOVE,this.onTouchMoved,this);\n        // this.node.on(cc.node.EventType.TOUCH_END,this.onTouchEnded,this);\n     \n        // this.node.on(\"touchmove\", (touch) => {\n        //     console.log(\"touchmove\");\n        //     return self.onTouchMoved(touch);\n        // }, this);\n     \n        // this.node.on(\"touchend\", () => {\n        //     console.log(\"touchend\");\n        //     return self.onTouchEnded();\n        // }, this);\n\n        // this.node.on('touchstart', function(){\n        //     console.log(\"start\");\n        // }, this.node);\n    \n        // this.node.on('touchmove', function (event) {\n        //     console.log(\"move\");\n        // }, this.node);\n    \n        // this.node.on('touchend', function () {\n        //     console.log(\"end\");\n        // }, this.node);\n\n\n        //touchstart 可以换成cc.Node.EventType.TOUCH_START\n        //this.node.on('touchstart', this.onTouchBegan, this);\n        //touchmove 可以换成cc.Node.EventType.TOUCH_MOVE\n        //this.node.on('touchmove', this.onTouchMoved, this);\n        //touchcancel 可以换成cc.Node.EventType.TOUCH_CANCEL\n        //this.node.on('touchcancel', this.onEventCancel, this);\n        //touchend 可以换成cc.Node.EventType.TOUCH_END\n        //this.node.on('touchend', this.onTouchEnded, this);\n\n\n        // this.node.on(cc.Node.EventType.TOUCH_START,function(t){\n    \t// \t//函数体内写事件发生时的事情\n    \t// \t//当触摸开始是打印以下字样\n        //     cc.log(\"触摸开始\");\n\n    \t// },this.node);\n\n        this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this);\n        this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this);\n        this.node.on(cc.Node.EventType.TOUCH_CANEL,this.onTouchEnded,this);\n\n        \n\n        // cc.systemEvent.on(cc.SystemEventType.KEY_DOWN,function(e){\n        //     cc.log(\"安检\");\n        //     switch(e.keyCode){\n        //         case cc.KEY.space:\n        //              cc.log(\"space key down\");\n        //              break;\n        //     }\n        // },this);\n\n\n        // this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n        //     console.log('Mouse down');\n        //   }, this);\n    },\n\n    test: function(event) {\n        cc.log(\"begin2 ==\" + event.getLocation());\n    },\n\n    onTouchBegan: function(event) {\n        //如果触摸类型为FOLLOW，则摇控杆的位置为触摸位置,触摸开始时候现形\n        if(this.touchType == TouchType.FOLLOW)\n        {\n            var touchPos = this.node.parent.convertToNodeSpaceAR(event.getLocation())\n            this.node.setPosition(touchPos);\n            return true;\n        }\n        else\n        {                    \n            //把触摸点坐标转换为相对与目标的模型坐标\n            var touchPos = this.node.convertToNodeSpaceAR(event.getLocation())\n            //点与圆心的距离\n            //var distance = cc.pDistance(touchPos, cc.Vec2(0, 0));\n            var distance = touchPos.sub(cc.Vec2(0, 0)).mag();\n\n            //如果点与圆心距离小于圆的半径,返回true\n            if(distance < this.radius ) {\n                if(distance>20){\n                    this.node.opacity = 255\n                    this.joystickBar.setPosition(touchPos);\n                    //更新角度\n                    this._getAngle(touchPos)\n                }\n                return true;\n            }\n        }\n        return false;\n    },\n\n    onTouchMoved: function(event) {\n                                \n        //把触摸点坐标转换为相对与目标的模型坐标\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation())\n        //点与圆心的距离\\\\\n        //var distance = cc.pDistance(touchPos, cc.Vec2(0, 0));\n        var distance = touchPos.sub(cc.Vec2(0, 0)).mag();\n\n        //如果点与圆心距离小于圆的半径,控杆跟随触摸点\n        if(this.radius >= distance){\n            if(distance>20){\n                this.node.opacity = 255;\n                this.joystickBar.setPosition(touchPos);\n                //更新角度\n                this._getAngle(touchPos)\n            }else {\n                this.node.opacity = 50\n                //摇杆恢复位置\n                this.joystickBar.setPosition(cc.Vec2(0,0));\n            \n                this.curAngle = null;\n                //调用角度变化回调\n                if(this.angleChange){\n                    this.angleChange(this.curAngle);\n                }\n                \n            }\n        }else{\n            //触摸监听目标\n            var x = Math.cos(this._getRadian(touchPos)) * this.radius;\n            var y = Math.sin(this._getRadian(touchPos)) * this.radius;\n            if(touchPos.x>0 && touchPos.y<0){\n                y *= -1;\n            }else if(touchPos.x<0 && touchPos.y<0){\n                y *= -1;\n            }\n\n            this.joystickBar.setPosition(cc.Vec3(x, y, 0));\n            //更新角度\n            this._getAngle(touchPos)\n        }\n\n    },\n    onTouchEnded: function(event) {        \n        this.node.opacity = 50\n\n        //如果触摸类型为FOLLOW，离开触摸后隐藏\n        if(this.touchType == TouchType.FOLLOW){\n            this.node.position = this.initPos\n        }\n        //摇杆恢复位置\n        this.joystickBar.setPosition(this.initBarPos);\n        this.curAngle = null\n        //调用角度变化回调\n        if(this.angleChange){\n            this.angleChange(this.curAngle);\n        }\n    },\n\n\n    //计算角度并返回\n    _getAngle: function(point)\n    {\n        this._angle =  Math.floor(this._getRadian(point)*180/Math.PI);\n        \n        if(point.x>0 && point.y<0){\n            this._angle = 360 - this._angle;\n        }else if(point.x<0 && point.y<0){\n            this._angle = 360 - this._angle;\n        }else if(point.x<0 && point.y==0){\n            this._angle = 180;\n        }else if(point.x>0 && point.y==0){\n            this._angle = 0;\n        }else if(point.x==0 && point.y>0){\n            this._angle = 90;\n        }else if(point.x==0 && point.y<0){\n            this._angle = 270;\n        }\n        this._updateCurAngle()\n        return this._angle;\n    },\n\n    //计算弧度并返回\n    _getRadian: function(point) {\n        var curZ = Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2));\n        if(curZ==0){\n            this._radian = 0;\n        }else {\n            this._radian = Math.acos(point.x/curZ);\n        }\n        return this._radian;\n    },\n\n    //更新当前角度\n    _updateCurAngle: function()\n    {\n        switch (this.directionType)\n        {\n            case DirectionType.FOUR:\n                this.curAngle = this._fourDirections();\n                break;\n            case DirectionType.EIGHT:\n                this.curAngle = this._eightDirections();\n                break;\n            case DirectionType.ALL:\n                this.curAngle = this._angle\n                break;\n            default :\n                this.curAngle = null\n                break;\n        }\n        //调用角度变化回调\n        if(this.angleChange){\n            this.angleChange(this.curAngle);\n        }\n    },\n\n\n    //四个方向移动(上下左右)\n    _fourDirections: function()\n    {\n        if(this._angle >= 45 && this._angle <= 135)\n        {\n            return 90\n        }\n        else if(this._angle >= 225 && this._angle <= 315)\n        {\n            return 270\n        }\n        else if(this._angle <= 225 && this._angle >= 180 || this._angle >= 135 && this._angle <= 180)\n        {\n            return 180\n        }\n        else if(this._angle <= 360 && this._angle >= 315 || this._angle >= 0 && this._angle <= 45)\n        {\n            return 0\n        }\n    },\n\n    //八个方向移动(上下左右、左上、右上、左下、右下)\n    _eightDirections: function()\n    {\n        if(this._angle >= 67.5 && this._angle <= 112.5)\n        {\n            return 90\n        }\n        else if(this._angle >= 247.5 && this._angle <= 292.5)\n        {\n            return 270\n        }\n        else if(this._angle <= 202.5 && this._angle >= 180 || this._angle >= 157.5 && this._angle <= 180)\n        {\n            return 180\n        }\n        else if(this._angle <= 360 && this._angle >= 337.5 || this._angle >= 0 && this._angle <= 22.5)\n        {\n            return 0\n        }\n        else if(this._angle >= 112.5 && this._angle <= 157.5)\n        {\n            return 135\n        }\n        else if(this._angle >= 22.5 && this._angle <= 67.5)\n        {\n            return 45\n        }\n        else if(this._angle >= 202.5 && this._angle <= 247.5)\n        {\n            return 225\n        }\n        else if(this._angle >= 292.5 && this._angle <= 337.5)\n        {\n            return 315\n        }\n    },\n\n    onDestroy: function()\n    {\n        //cc.eventManager.removeListener(this._listener);\n        // this.node.off(\"touchstart\");\n        // this.node.off(\"touchmove\");\n        // this.node.off(\"touchend\");\n\n        this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this);\n        this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this);\n    }\n\n});\n"]}