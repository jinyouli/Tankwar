
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/TankScript.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6ce61tIUVFH+4QczJMrP1cD', 'TankScript');
// scripts/TankScript.js

"use strict";

var TankType = require("TankData").tankType;

cc.Class({
  "extends": cc.Component,
  properties: {
    //坦克类型
    tankType: {
      "default": TankType.Normal,
      type: TankType
    },
    //速度
    speed: 20,
    //子弹
    bullet: cc.Prefab,
    //发射子弹间隔时间
    fireTime: 0.5,
    //血量
    blood: 1,
    //所属组织
    team: 0,
    //爆炸动画
    blast: cc.Prefab,
    //射击音效
    shootAudio: {
      "default": null,
      url: cc.AudioClip
    },
    //坦克皮肤
    spriteFrames: {
      "default": [],
      type: cc.SpriteFrame
    },
    die: false,
    stop: false
  },
  // use this for initialization
  onLoad: function onLoad() {
    //获取组件
    this._cityCtrl = cc.find("/CityScript").getComponent("CityScript");
    this.bulletNode = cc.find("/Canvas/Map/bullet");
  },
  start: function start() {
    //初始是停止状态的
    this.stopMove = true;
    this.stop = false; //偏移量

    this.offset = cc.v2();

    if (this.tankType != TankType.Player) {
      var self = this; //添加AI

      var callback = cc.callFunc(function () {
        var angles = [0, 90, 180, 270];
        var index = parseInt(Math.random() * 4, 10);
        self.tankMoveStart(angles[index]);
        self.startFire(self._cityCtrl.bulletPool);
      }, this);
      var seq = cc.sequence(cc.delayTime(0.3), callback, cc.delayTime(1));
      this.node.runAction(cc.repeatForever(seq));
    }
  },
  //添加坦克移动动作
  tankMoveStart: function tankMoveStart(angle) {
    this.node.angle = angle - 90;

    if (angle == 0 || angle == 180 || angle == 90) {
      this.offset = cc.v2(Math.floor(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else if (angle == 270) {
      this.offset = cc.v2(Math.ceil(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else {
      this.offset = cc.v2(Math.cos(Math.PI / 180 * angle), Math.sin(Math.PI / 180 * angle));
    }

    this.stopMove = false;
  },
  //移除坦克移动动作
  tankMoveStop: function tankMoveStop() {
    this.stopMove = true;
  },
  tankStop: function tankStop() {
    this.stop = true;
    cc.director.getActionManager().pauseAllRunningActions();
  },
  // called every frame, uncomment this function to activate update callback
  update: function update(dt) {
    if (this.stop) {
      return;
    }

    if (!this.stopMove) {
      var boundingBox = this.node.getBoundingBox();
      var rect = cc.rect(boundingBox.xMin + this.offset.x * this.speed * dt * 1.5, boundingBox.yMin + this.offset.y * this.speed * dt * 1.7, boundingBox.size.width, boundingBox.size.height);

      if (this._cityCtrl.collisionTest(rect) //检测与地图的碰撞
      || this.collisionTank(rect)) {
        this.tankMoveStop();
      } else {
        this.node.x += this.offset.x * this.speed * dt;
        this.node.y += this.offset.y * this.speed * dt;
      }
    }

    if (this.stopFire) {
      this.fireTime -= dt;

      if (this.fireTime <= 0) {
        this.stopFire = false;
      }
    }
  },
  //判断是否与其他坦克碰撞
  collisionTank: function collisionTank(rect) {
    for (var i = 0; i < cc.gameData.tankList.length; i++) {
      var tank = cc.gameData.tankList[i];

      if (this.node === tank) {
        continue;
      }

      var boundingBox = tank.getBoundingBox(); // if(cc.rectIntersectsRect(rect, boundingBox)){

      if (rect.intersects(boundingBox)) {
        return true;
      }
    }

    return false;
  },
  //开火
  startFire: function startFire(bulletPool) {
    if (this.stopFire) {
      return false;
    }

    this.stopFire = true;
    this.fireTime = 0.5;
    var bullet = null;

    if (bulletPool.size() > 0) {
      bullet = bulletPool.get(bulletPool);
    } else {
      bullet = cc.instantiate(this.bullet);
    } //设置子弹位置,角度


    bullet.angle = this.node.angle;
    var pos = this.node.position;
    var angle = this.node.angle - 90;
    var offset = cc.v2(0, 0);

    if (angle == 0 || angle == 180 || angle == 90) {
      offset = cc.v2(Math.floor(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else if (angle == 270) {
      offset = cc.v2(Math.ceil(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)));
    } else {
      offset = cc.v2(Math.cos(Math.PI / 180 * angle), Math.sin(Math.PI / 180 * angle));
    }

    if (angle == -90) {
      //cc.log("上");
      bullet.position = pos.add(cc.v2(10 * offset.x, 10 * offset.y + 15));
    } else if (angle == 0) {
      //cc.log("左");
      bullet.position = pos.add(cc.v2(10 * offset.x - 15, 10 * offset.y));
    } else if (angle == -180) {
      //cc.log("右");
      bullet.position = pos.add(cc.v2(10 * offset.x + 15, 10 * offset.y));
    } else if (angle == 90) {
      //cc.log("下");
      bullet.position = pos.add(cc.v2(10 * offset.x, 10 * offset.y - 15));
    } // bullet.position = cc.pAdd(pos,cc.v2(10*offset.x, 10*offset.y));


    bullet.getComponent("BulletScript").bulletMove();
    bullet.parent = this.bulletNode; //子弹标记

    bullet.camp = this.team; //加到列表

    cc.gameData.bulletList.push(bullet);
    return true;
  },
  //爆炸
  boom: function boom() {
    var blast = cc.instantiate(this.blast);
    blast.parent = this.node.parent;
    blast.position = this.node.position;
    var anim = blast.getComponent(cc.Animation);
    anim.play();

    this._cityCtrl.tankBoom(this.node);
  },
  turnGreen: function turnGreen(index) {
    this.node.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[index];
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1RhbmtTY3JpcHQuanMiXSwibmFtZXMiOlsiVGFua1R5cGUiLCJyZXF1aXJlIiwidGFua1R5cGUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIk5vcm1hbCIsInR5cGUiLCJzcGVlZCIsImJ1bGxldCIsIlByZWZhYiIsImZpcmVUaW1lIiwiYmxvb2QiLCJ0ZWFtIiwiYmxhc3QiLCJzaG9vdEF1ZGlvIiwidXJsIiwiQXVkaW9DbGlwIiwic3ByaXRlRnJhbWVzIiwiU3ByaXRlRnJhbWUiLCJkaWUiLCJzdG9wIiwib25Mb2FkIiwiX2NpdHlDdHJsIiwiZmluZCIsImdldENvbXBvbmVudCIsImJ1bGxldE5vZGUiLCJzdGFydCIsInN0b3BNb3ZlIiwib2Zmc2V0IiwidjIiLCJQbGF5ZXIiLCJzZWxmIiwiY2FsbGJhY2siLCJjYWxsRnVuYyIsImFuZ2xlcyIsImluZGV4IiwicGFyc2VJbnQiLCJNYXRoIiwicmFuZG9tIiwidGFua01vdmVTdGFydCIsInN0YXJ0RmlyZSIsImJ1bGxldFBvb2wiLCJzZXEiLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsIm5vZGUiLCJydW5BY3Rpb24iLCJyZXBlYXRGb3JldmVyIiwiYW5nbGUiLCJmbG9vciIsImNvcyIsIlBJIiwic2luIiwiY2VpbCIsInRhbmtNb3ZlU3RvcCIsInRhbmtTdG9wIiwiZGlyZWN0b3IiLCJnZXRBY3Rpb25NYW5hZ2VyIiwicGF1c2VBbGxSdW5uaW5nQWN0aW9ucyIsInVwZGF0ZSIsImR0IiwiYm91bmRpbmdCb3giLCJnZXRCb3VuZGluZ0JveCIsInJlY3QiLCJ4TWluIiwieCIsInlNaW4iLCJ5Iiwic2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwiY29sbGlzaW9uVGVzdCIsImNvbGxpc2lvblRhbmsiLCJzdG9wRmlyZSIsImkiLCJnYW1lRGF0YSIsInRhbmtMaXN0IiwibGVuZ3RoIiwidGFuayIsImludGVyc2VjdHMiLCJnZXQiLCJpbnN0YW50aWF0ZSIsInBvcyIsInBvc2l0aW9uIiwiYWRkIiwiYnVsbGV0TW92ZSIsInBhcmVudCIsImNhbXAiLCJidWxsZXRMaXN0IiwicHVzaCIsImJvb20iLCJhbmltIiwiQW5pbWF0aW9uIiwicGxheSIsInRhbmtCb29tIiwidHVybkdyZWVuIiwiU3ByaXRlIiwic3ByaXRlRnJhbWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsSUFBSUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFQLENBQW9CQyxRQUFuQzs7QUFFQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBRVI7QUFDQUosSUFBQUEsUUFBUSxFQUFFO0FBQ04saUJBQVNGLFFBQVEsQ0FBQ08sTUFEWjtBQUVOQyxNQUFBQSxJQUFJLEVBQUVSO0FBRkEsS0FIRjtBQU9SO0FBQ0FTLElBQUFBLEtBQUssRUFBRSxFQVJDO0FBU1I7QUFDQUMsSUFBQUEsTUFBTSxFQUFFUCxFQUFFLENBQUNRLE1BVkg7QUFXUjtBQUNBQyxJQUFBQSxRQUFRLEVBQUUsR0FaRjtBQWFSO0FBQ0FDLElBQUFBLEtBQUssRUFBRSxDQWRDO0FBZVI7QUFDQUMsSUFBQUEsSUFBSSxFQUFFLENBaEJFO0FBaUJSO0FBQ0FDLElBQUFBLEtBQUssRUFBRVosRUFBRSxDQUFDUSxNQWxCRjtBQW1CUjtBQUNBSyxJQUFBQSxVQUFVLEVBQUU7QUFDUixpQkFBUyxJQUREO0FBRVJDLE1BQUFBLEdBQUcsRUFBRWQsRUFBRSxDQUFDZTtBQUZBLEtBcEJKO0FBd0JSO0FBQ0FDLElBQUFBLFlBQVksRUFBRTtBQUNWLGlCQUFTLEVBREM7QUFFVlgsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNpQjtBQUZDLEtBekJOO0FBOEJSQyxJQUFBQSxHQUFHLEVBQUUsS0E5Qkc7QUErQlJDLElBQUFBLElBQUksRUFBRTtBQS9CRSxHQUhQO0FBc0NMO0FBQ0FDLEVBQUFBLE1BQU0sRUFBRSxrQkFBWTtBQUNoQjtB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QUNXLFlBQU4sQ0FBbUJ2QixFQUFFLENBQUMyRixTQUF0QixDQUFYO0FBQ0FELElBQUFBLElBQUksQ0FBQ0UsSUFBTDs7QUFDQSxTQUFLdkUsU0FBTCxDQUFld0UsUUFBZixDQUF3QixLQUFLakQsSUFBN0I7QUFDSCxHQXROSTtBQXdOTGtELEVBQUFBLFNBQVMsRUFBRSxtQkFBUzVELEtBQVQsRUFBZTtBQUN0QixTQUFLVSxJQUFMLENBQVVyQixZQUFWLENBQXVCdkIsRUFBRSxDQUFDK0YsTUFBMUIsRUFBa0NDLFdBQWxDLEdBQWdELEtBQUtoRixZQUFMLENBQWtCa0IsS0FBbEIsQ0FBaEQ7QUFDSDtBQTFOSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBUYW5rVHlwZSA9IHJlcXVpcmUoXCJUYW5rRGF0YVwiKS50YW5rVHlwZTtcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcblxuICAgICAgICAvL+WdpuWFi+exu+Wei1xuICAgICAgICB0YW5rVHlwZToge1xuICAgICAgICAgICAgZGVmYXVsdDogVGFua1R5cGUuTm9ybWFsLFxuICAgICAgICAgICAgdHlwZTogVGFua1R5cGVcbiAgICAgICAgfSwgXG4gICAgICAgIC8v6YCf5bqmXG4gICAgICAgIHNwZWVkOiAyMCxcbiAgICAgICAgLy/lrZDlvLlcbiAgICAgICAgYnVsbGV0OiBjYy5QcmVmYWIsXG4gICAgICAgIC8v5Y+R5bCE5a2Q5by56Ze06ZqU5pe26Ze0XG4gICAgICAgIGZpcmVUaW1lOiAwLjUsXG4gICAgICAgIC8v6KGA6YePXG4gICAgICAgIGJsb29kOiAxLFxuICAgICAgICAvL+aJgOWxnue7hOe7h1xuICAgICAgICB0ZWFtOiAwLFxuICAgICAgICAvL+eIhueCuOWKqOeUu1xuICAgICAgICBibGFzdDogY2MuUHJlZmFiLFxuICAgICAgICAvL+WwhOWHu+mfs+aViFxuICAgICAgICBzaG9vdEF1ZGlvOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdXJsOiBjYy5BdWRpb0NsaXAsXG4gICAgICAgIH0sXG4gICAgICAgIC8v5Z2m5YWL55qu6IKkXG4gICAgICAgIHNwcml0ZUZyYW1lczoge1xuICAgICAgICAgICAgZGVmYXVsdDogW10sXG4gICAgICAgICAgICB0eXBlOiBjYy5TcHJpdGVGcmFtZSxcbiAgICAgICAgfSxcblxuICAgICAgICBkaWU6IGZhbHNlLFxuICAgICAgICBzdG9wOiBmYWxzZSxcblxuICAgIH0sXG5cbiAgICAvLyB1c2UgdGhpcyBmb3IgaW5pdGlhbGl6YXRpb25cbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy/ojrflj5bnu4Tku7ZcbiAgICAgICAgdGhpcy5fY2l0eUN0cmwgPSBjYy5maW5kKFwiL0NpdHlTY3JpcHRcIikuZ2V0Q29tcG9uZW50KFwiQ2l0eVNjcmlwdFwiKTtcbiAgICAgICAgdGhpcy5idWxsZXROb2RlID0gY2MuZmluZChcIi9DYW52YXMvTWFwL2J1bGxldFwiKTtcbiAgICB9LFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+WIneWni+aYr+WBnOatoueKtuaAgeeahFxuICAgICAgICB0aGlzLnN0b3BNb3ZlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wID0gZmFsc2U7XG4gICAgICAgIC8v5YGP56e76YePXG4gICAgICAgIHRoaXMub2Zmc2V0ID0gY2MudjIoKTtcblxuICAgICAgICBpZih0aGlzLnRhbmtUeXBlICE9IFRhbmtUeXBlLlBsYXllcil7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAvL+a3u+WKoEFJXG4gICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBjYy5jYWxsRnVuYyhmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBhbmdsZXMgPSBbMCwgOTAsIDE4MCwgMjcwXTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBwYXJzZUludChNYXRoLnJhbmRvbSgpKjQsIDEwKTtcbiAgICAgICAgICAgICAgICBzZWxmLnRhbmtNb3ZlU3RhcnQoYW5nbGVzW2luZGV4XSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0RmlyZShzZWxmLl9jaXR5Q3RybC5idWxsZXRQb29sKTtcblxuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIHZhciBzZXEgPSBjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMC4zKSwgY2FsbGJhY2ssIGNjLmRlbGF5VGltZSgxKSk7XG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLnJlcGVhdEZvcmV2ZXIoc2VxKSk7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvL+a3u+WKoOWdpuWFi+enu+WKqOWKqOS9nFxuICAgIHRhbmtNb3ZlU3RhcnQ6IGZ1bmN0aW9uIChhbmdsZSkge1xuXG4gICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IGFuZ2xlIC0gOTA7XG5cbiAgICAgICAgaWYoYW5nbGU9PTAgfHwgYW5nbGU9PTE4MCB8fCBhbmdsZT09OTApe1xuICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBjYy52MihNYXRoLmZsb29yKE1hdGguY29zKE1hdGguUEkvMTgwKmFuZ2xlKSksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnNpbihNYXRoLlBJLzE4MCphbmdsZSkpKTtcbiAgICAgICAgfWVsc2UgaWYoYW5nbGU9PTI3MCl7XG5cbiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gY2MudjIoTWF0aC5jZWlsKE1hdGguY29zKE1hdGguUEkvMTgwKmFuZ2xlKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5zaW4oTWF0aC5QSS8xODAqYW5nbGUpKSk7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gY2MudjIoTWF0aC5jb3MoTWF0aC5QSS8xODAqYW5nbGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbihNYXRoLlBJLzE4MCphbmdsZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdG9wTW92ZSA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICAvL+enu+mZpOWdpuWFi+enu+WKqOWKqOS9nFxuICAgIHRhbmtNb3ZlU3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0b3BNb3ZlID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgdGFua1N0b3A6IGZ1bmN0aW9uICgpe1xuICAgICAgICB0aGlzLnN0b3AgPSB0cnVlO1xuICAgICAgICBjYy5kaXJlY3Rvci5nZXRBY3Rpb25NYW5hZ2VyKCkucGF1c2VBbGxSdW5uaW5nQWN0aW9ucygpO1xuICAgIH0sXG5cbiAgICAvLyBjYWxsZWQgZXZlcnkgZnJhbWUsIHVuY29tbWVudCB0aGlzIGZ1bmN0aW9uIHRvIGFjdGl2YXRlIHVwZGF0ZSBjYWxsYmFja1xuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG5cbiAgICAgICAgaWYodGhpcy5zdG9wKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKCF0aGlzLnN0b3BNb3ZlKXtcbiAgICAgICAgICAgIHZhciBib3VuZGluZ0JveCA9IHRoaXMubm9kZS5nZXRCb3VuZGluZ0JveCgpO1xuICAgICAgICAgICAgdmFyIHJlY3QgPSBjYy5yZWN0KGJvdW5kaW5nQm94LnhNaW4gKyB0aGlzLm9mZnNldC54KnRoaXMuc3BlZWQqZHQqMS41LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94LnlNaW4gKyB0aGlzLm9mZnNldC55KnRoaXMuc3BlZWQqZHQqMS43LCBcblx0XHQgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94LnNpemUud2lkdGgsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kaW5nQm94LnNpemUuaGVpZ2h0KTtcbiAgICAgICAgICAgIGlmKHRoaXMuX2NpdHlDdHJsLmNvbGxpc2lvblRlc3QocmVjdCkgLy/mo4DmtYvkuI7lnLDlm77nmoTnorDmkp5cbiAgICAgICAgICAgICAgICB8fCB0aGlzLmNvbGxpc2lvblRhbmsocmVjdClcbiAgICAgICAgICAgICAgICApe1xuICAgICAgICAgICAgICAgIHRoaXMudGFua01vdmVTdG9wKCk7XG4gICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnggKz0gdGhpcy5vZmZzZXQueCp0aGlzLnNwZWVkKmR0O1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS55ICs9IHRoaXMub2Zmc2V0LnkqdGhpcy5zcGVlZCpkdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnN0b3BGaXJlKXtcbiAgICAgICAgICAgIHRoaXMuZmlyZVRpbWUgLT0gZHQ7XG4gICAgICAgICAgICBpZih0aGlzLmZpcmVUaW1lPD0wKXtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BGaXJlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvL+WIpOaWreaYr+WQpuS4juWFtuS7luWdpuWFi+eisOaSnlxuICAgIGNvbGxpc2lvblRhbms6IGZ1bmN0aW9uKHJlY3QpIHtcbiAgICAgICAgZm9yKHZhciBpPTA7IGk8Y2MuZ2FtZURhdGEudGFua0xpc3QubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgdmFyIHRhbmsgPSBjYy5nYW1lRGF0YS50YW5rTGlzdFtpXVxuICAgICAgICAgICAgaWYodGhpcy5ub2RlID09PSB0YW5rKXtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBib3VuZGluZ0JveCA9IHRhbmsuZ2V0Qm91bmRpbmdCb3goKTtcbiAgICAgICAgICAgIC8vIGlmKGNjLnJlY3RJbnRlcnNlY3RzUmVjdChyZWN0LCBib3VuZGluZ0JveCkpe1xuICAgICAgICAgICAgaWYocmVjdC5pbnRlcnNlY3RzKGJvdW5kaW5nQm94KSl7ICBcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIC8v5byA54GrXG4gICAgc3RhcnRGaXJlOiBmdW5jdGlvbiAoYnVsbGV0UG9vbCl7XG4gICAgICAgIGlmKHRoaXMuc3RvcEZpcmUpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RvcEZpcmUgPSB0cnVlO1xuICAgICAgICB0aGlzLmZpcmVUaW1lID0gMC41O1xuXG4gICAgICAgIHZhciBidWxsZXQgPSBudWxsO1xuICAgICAgICBpZihidWxsZXRQb29sLnNpemUoKT4wKXtcbiAgICAgICAgICAgIGJ1bGxldCA9IGJ1bGxldFBvb2wuZ2V0KGJ1bGxldFBvb2wpO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBidWxsZXQgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmJ1bGxldCk7XG4gICAgICAgIH1cbiAgICAgICAgLy/orr7nva7lrZDlvLnkvY3nva4s6KeS5bqmXG4gICAgICAgIGJ1bGxldC5hbmdsZSA9IHRoaXMubm9kZS5hbmdsZTtcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMubm9kZS5wb3NpdGlvbjtcblxuICAgICAgICB2YXIgYW5nbGUgPSB0aGlzLm5vZGUuYW5nbGUgLSA5MDtcbiAgICAgICAgdmFyIG9mZnNldCA9IGNjLnYyKDAsIDApO1xuICAgICAgICBpZihhbmdsZT09MCB8fCBhbmdsZT09MTgwIHx8IGFuZ2xlPT05MCl7XG4gICAgICAgICAgICBvZmZzZXQgPSBjYy52MihNYXRoLmZsb29yKE1hdGguY29zKE1hdGguUEkvMTgwKmFuZ2xlKSksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGguc2luKE1hdGguUEkvMTgwKmFuZ2xlKSkpO1xuICAgICAgICB9ZWxzZSBpZihhbmdsZT09MjcwKXtcbiAgICAgICAgICAgIG9mZnNldCA9IGNjLnYyKE1hdGguY2VpbChNYXRoLmNvcyhNYXRoLlBJLzE4MCphbmdsZSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGguc2luKE1hdGguUEkvMTgwKmFuZ2xlKSkpO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBvZmZzZXQgPSBjYy52MihNYXRoLmNvcyhNYXRoLlBJLzE4MCphbmdsZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguc2luKE1hdGguUEkvMTgwKmFuZ2xlKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZihhbmdsZSA9PSAtOTApe1xuICAgICAgICAgICAgLy9jYy5sb2coXCLkuIpcIik7XG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54LCAxMCpvZmZzZXQueSArIDE1KSk7XG4gICAgICAgIH1lbHNlIGlmKGFuZ2xlID09IDApe1xuICAgICAgICAgICAgLy9jYy5sb2coXCLlt6ZcIik7XG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54IC0gMTUsIDEwKm9mZnNldC55KSk7XG4gICAgICAgIH1lbHNlIGlmKGFuZ2xlID09IC0xODApe1xuICAgICAgICAgICAgLy9jYy5sb2coXCLlj7NcIik7XG4gICAgICAgICAgICBidWxsZXQucG9zaXRpb24gPSBwb3MuYWRkKGNjLnYyKDEwKm9mZnNldC54ICsgMTUsIDEwKm9mZnNldC55KSk7XG4gICAgICAgIH1lbHNlIGlmKGFuZ2xlID09IDkwKXtcbiAgICAgICAgICAgIC8vY2MubG9nKFwi5LiLXCIpO1xuICAgICAgICAgICAgYnVsbGV0LnBvc2l0aW9uID0gcG9zLmFkZChjYy52MigxMCpvZmZzZXQueCwgMTAqb2Zmc2V0LnkgLSAxNSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYnVsbGV0LnBvc2l0aW9uID0gY2MucEFkZChwb3MsY2MudjIoMTAqb2Zmc2V0LngsIDEwKm9mZnNldC55KSk7XG5cbiAgICAgICAgYnVsbGV0LmdldENvbXBvbmVudChcIkJ1bGxldFNjcmlwdFwiKS5idWxsZXRNb3ZlKCk7XG4gICAgICAgIGJ1bGxldC5wYXJlbnQgPSB0aGlzLmJ1bGxldE5vZGU7XG4gICAgICAgIC8v5a2Q5by55qCH6K6wXG4gICAgICAgIGJ1bGxldC5jYW1wID0gdGhpcy50ZWFtO1xuICAgICAgICBcblxuICAgICAgICAvL+WKoOWIsOWIl+ihqFxuICAgICAgICBjYy5nYW1lRGF0YS5idWxsZXRMaXN0LnB1c2goYnVsbGV0KTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/niIbngrhcbiAgICBib29tOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgYmxhc3QgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmJsYXN0KTtcbiAgICAgICAgYmxhc3QucGFyZW50ID0gdGhpcy5ub2RlLnBhcmVudDtcbiAgICAgICAgYmxhc3QucG9zaXRpb24gPSB0aGlzLm5vZGUucG9zaXRpb247XG4gICAgICAgIHZhciBhbmltID0gYmxhc3QuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG4gICAgICAgIGFuaW0ucGxheSgpO1xuICAgICAgICB0aGlzLl9jaXR5Q3RybC50YW5rQm9vbSh0aGlzLm5vZGUpO1xuICAgIH0sXG5cbiAgICB0dXJuR3JlZW46IGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgICAgdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5zcHJpdGVGcmFtZXNbaW5kZXhdO1xuICAgIH0sXG5cbn0pO1xuIl19