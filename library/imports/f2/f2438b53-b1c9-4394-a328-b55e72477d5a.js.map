{"version":3,"sources":["assets/scripts/BulletScript.js"],"names":["TankType","require","tankType","cc","Class","Component","properties","speed","camp","onLoad","_cityCtrl","find","getComponent","reuse","bulletPool","bulletMove","angle","node","offset","v2","Math","floor","cos","PI","sin","ceil","bulletBoom","parent","put","update","dt","x","y","rect","getBoundingBox","collisionTest","collisionTank","i","gameData","tankList","length","tank","tankCtrl","team","die","boundingBox","intersects","blood","boom","turnGreen"],"mappings":"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","sourceRoot":"/","sourcesContent":["var TankType = require(\"TankData\").tankType;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,      // The default value will be used only when the component attaching\n        //                           to a node for the first time\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        speed: 20,\n        camp : 0,\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._cityCtrl = cc.find(\"/CityScript\").getComponent(\"CityScript\");\n    },\n\n    //对象池get获取对象是会调用此方法\n    reuse: function (bulletPool) {\n        this.bulletPool = bulletPool; // get 中传入的子弹对象池\n    },\n\n    //子弹移动\n    bulletMove: function () {\n        //偏移\n        var angle = this.node.angle + 90;\n        if(angle==0 || angle==180 || angle==90){\n            this.offset = cc.v2(Math.floor(Math.cos(Math.PI/180*angle)), \n                                Math.floor(Math.sin(Math.PI/180*angle)));\n        }else if(angle==270){\n            this.offset = cc.v2(Math.ceil(Math.cos(Math.PI/180*angle)),\n                                Math.floor(Math.sin(Math.PI/180*angle)));\n        }else {\n            this.offset = cc.v2(Math.cos(Math.PI/180*angle),\n                                Math.sin(Math.PI/180*angle));\n        }\n    },\n\n    //子弹爆炸\n    bulletBoom: function () {\n        this.node.parent = null;\n        this.bulletPool.put(this.node);\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        //移动\n        this.node.x += this.offset.x*this.speed*dt;\n        this.node.y += this.offset.y*this.speed*dt;\n\n        //检测碰撞\n        var rect = this.node.getBoundingBox();\n        if(this._cityCtrl.collisionTest(rect, true)\n            || this.collisionTank(rect)){\n            //子弹爆炸\n            this.bulletBoom();\n        }\n\n    },\n\n    //判断与坦克碰撞\n    collisionTank: function(rect) {\n        for(var i=0; i<cc.gameData.tankList.length; i++){\n            var tank = cc.gameData.tankList[i]\n            var tankCtrl = tank.getComponent(\"TankScript\");\n            if(tankCtrl.team == this.node.camp || tankCtrl.die){\n                //同一队不互相伤害\n                continue;\n            }\n            var boundingBox = tank.getBoundingBox();\n            if(rect.intersects(boundingBox)){\n                if(--tankCtrl.blood <= 0){\n                    tankCtrl.boom();\n                }\n                else{\n                    tankCtrl.turnGreen(tankCtrl.blood);\n                }\n                return true;\n            }\n        }\n        return false;\n    },\n\n});\n"]}