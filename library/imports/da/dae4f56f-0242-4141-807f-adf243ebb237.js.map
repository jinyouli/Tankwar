{"version":3,"sources":["assets\\joystick\\scripts\\JoystickCtrl.js"],"names":["TouchType","cc","Enum","DEFAULT","FOLLOW","DirectionType","FOUR","EIGHT","ALL","Class","Component","properties","joystickBar","type","Node","joystickBG","radius","touchType","directionType","curAngle","visible","distance","onLoad","width","registerInput","initPos","node","position","initBarPos","opacity","addJoyStickTouchChangeListener","callback","angleChange","on","EventType","TOUCH_START","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded","TOUCH_CANEL","event","touchPos","parent","convertToNodeSpaceAR","getLocation","setPosition","sub","Vec2","mag","_getAngle","x","Math","cos","_getRadian","y","sin","Vec3","point","_angle","floor","PI","_updateCurAngle","curZ","sqrt","pow","_radian","acos","_fourDirections","_eightDirections","onDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\nvar TouchType = cc.Enum({\r\n    DEFAULT: 0,\r\n    FOLLOW: 1\r\n});\r\n\r\nvar DirectionType = cc.Enum({\r\n    FOUR: 0,\r\n    EIGHT: 1,\r\n    ALL: 2\r\n});\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        joystickBar: {\r\n            default: null,\r\n            type: cc.Node\r\n        },//控杆\r\n        joystickBG: {\r\n            default: null,\r\n            type: cc.Node\r\n        },//控杆背景\r\n        radius: 0, //半径\r\n        touchType: {\r\n            default: TouchType.DEFAULT, //触摸类型\r\n            type: TouchType\r\n        },\r\n        directionType: {\r\n            default: DirectionType.ALL,  //方向类型\r\n            type: DirectionType\r\n        },\r\n        //当前角度\r\n        curAngle: {\r\n            default: 0,\r\n            visible: false\r\n        },\r\n        //当前距离\r\n        distance: {\r\n            default: 0,\r\n            visible: false\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(this.radius == 0){\r\n            this.radius = this.joystickBG.width/2\r\n        }\r\n        this.registerInput()\r\n        this.distance = 0\r\n        this.curAngle = 0\r\n        this.initPos = this.node.position\r\n        this.initBarPos = this.joystickBar.position\r\n        \r\n        this.node.opacity = 240\r\n    },\r\n\r\n    addJoyStickTouchChangeListener: function(callback) {\r\n        this.angleChange = callback;\r\n    },\r\n\r\n    registerInput: function() {\r\n        this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANEL,this.onTouchEnded,this);\r\n\r\n    },\r\n\r\n    onTouchBegan: function(event) {\r\n        //如果触摸类型为FOLLOW，则摇控杆的位置为触摸位置,触摸开始时候现形\r\n        if(this.touchType == TouchType.FOLLOW)\r\n        {\r\n            var touchPos = this.node.parent.convertToNodeSpaceAR(event.getLocation())\r\n            this.node.setPosition(touchPos);\r\n            return true;\r\n        }\r\n        else\r\n        {                    \r\n            //把触摸点坐标转换为相对与目标的模型坐标\r\n            var touchPos = this.node.convertToNodeSpaceAR(event.getLocation())\r\n            //点与圆心的距离\r\n            //var distance = cc.pDistance(touchPos, cc.Vec2(0, 0));\r\n            var distance = touchPos.sub(cc.Vec2(0, 0)).mag();\r\n\r\n            //如果点与圆心距离小于圆的半径,返回true\r\n            if(distance < this.radius ) {\r\n                if(distance>20){\r\n                    this.node.opacity = 255\r\n                    this.joystickBar.setPosition(touchPos);\r\n                    //更新角度\r\n                    this._getAngle(touchPos)\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    onTouchMoved: function(event) {\r\n                                \r\n        //把触摸点坐标转换为相对与目标的模型坐标\r\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation())\r\n        //点与圆心的距离\\\\\r\n        //var distance = cc.pDistance(touchPos, cc.Vec2(0, 0));\r\n        var distance = touchPos.sub(cc.Vec2(0, 0)).mag();\r\n\r\n        //如果点与圆心距离小于圆的半径,控杆跟随触摸点\r\n        if(this.radius >= distance){\r\n            if(distance>20){\r\n                this.node.opacity = 255;\r\n                this.joystickBar.setPosition(touchPos);\r\n                //更新角度\r\n                this._getAngle(touchPos)\r\n            }else {\r\n                this.node.opacity = 240\r\n                //摇杆恢复位置\r\n                this.joystickBar.setPosition(cc.Vec2(0,0));\r\n            \r\n                this.curAngle = null;\r\n                //调用角度变化回调\r\n                if(this.angleChange){\r\n                    this.angleChange(this.curAngle);\r\n                }\r\n                \r\n            }\r\n        }else{\r\n            //触摸监听目标\r\n            var x = Math.cos(this._getRadian(touchPos)) * this.radius;\r\n            var y = Math.sin(this._getRadian(touchPos)) * this.radius;\r\n            if(touchPos.x>0 && touchPos.y<0){\r\n                y *= -1;\r\n            }else if(touchPos.x<0 && touchPos.y<0){\r\n                y *= -1;\r\n            }\r\n\r\n            this.joystickBar.setPosition(cc.Vec3(x, y, 0));\r\n            //更新角度\r\n            this._getAngle(touchPos)\r\n        }\r\n\r\n    },\r\n    onTouchEnded: function(event) {        \r\n        this.node.opacity = 240\r\n\r\n        //如果触摸类型为FOLLOW，离开触摸后隐藏\r\n        if(this.touchType == TouchType.FOLLOW){\r\n            this.node.position = this.initPos\r\n        }\r\n        //摇杆恢复位置\r\n        this.joystickBar.setPosition(this.initBarPos);\r\n        this.curAngle = null\r\n        //调用角度变化回调\r\n        if(this.angleChange){\r\n            this.angleChange(this.curAngle);\r\n        }\r\n    },\r\n\r\n\r\n    //计算角度并返回\r\n    _getAngle: function(point)\r\n    {\r\n        this._angle =  Math.floor(this._getRadian(point)*180/Math.PI);\r\n        \r\n        if(point.x>0 && point.y<0){\r\n            this._angle = 360 - this._angle;\r\n        }else if(point.x<0 && point.y<0){\r\n            this._angle = 360 - this._angle;\r\n        }else if(point.x<0 && point.y==0){\r\n            this._angle = 180;\r\n        }else if(point.x>0 && point.y==0){\r\n            this._angle = 0;\r\n        }else if(point.x==0 && point.y>0){\r\n            this._angle = 90;\r\n        }else if(point.x==0 && point.y<0){\r\n            this._angle = 270;\r\n        }\r\n        this._updateCurAngle()\r\n        return this._angle;\r\n    },\r\n\r\n    //计算弧度并返回\r\n    _getRadian: function(point) {\r\n        var curZ = Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2));\r\n        if(curZ==0){\r\n            this._radian = 0;\r\n        }else {\r\n            this._radian = Math.acos(point.x/curZ);\r\n        }\r\n        return this._radian;\r\n    },\r\n\r\n    //更新当前角度\r\n    _updateCurAngle: function()\r\n    {\r\n        switch (this.directionType)\r\n        {\r\n            case DirectionType.FOUR:\r\n                this.curAngle = this._fourDirections();\r\n                break;\r\n            case DirectionType.EIGHT:\r\n                this.curAngle = this._eightDirections();\r\n                break;\r\n            case DirectionType.ALL:\r\n                this.curAngle = this._angle\r\n                break;\r\n            default :\r\n                this.curAngle = null\r\n                break;\r\n        }\r\n        //调用角度变化回调\r\n        if(this.angleChange){\r\n            this.angleChange(this.curAngle);\r\n        }\r\n    },\r\n\r\n\r\n    //四个方向移动(上下左右)\r\n    _fourDirections: function()\r\n    {\r\n        if(this._angle >= 45 && this._angle <= 135)\r\n        {\r\n            return 90\r\n        }\r\n        else if(this._angle >= 225 && this._angle <= 315)\r\n        {\r\n            return 270\r\n        }\r\n        else if(this._angle <= 225 && this._angle >= 180 || this._angle >= 135 && this._angle <= 180)\r\n        {\r\n            return 180\r\n        }\r\n        else if(this._angle <= 360 && this._angle >= 315 || this._angle >= 0 && this._angle <= 45)\r\n        {\r\n            return 0\r\n        }\r\n    },\r\n\r\n    //八个方向移动(上下左右、左上、右上、左下、右下)\r\n    _eightDirections: function()\r\n    {\r\n        if(this._angle >= 67.5 && this._angle <= 112.5)\r\n        {\r\n            return 90\r\n        }\r\n        else if(this._angle >= 247.5 && this._angle <= 292.5)\r\n        {\r\n            return 270\r\n        }\r\n        else if(this._angle <= 202.5 && this._angle >= 180 || this._angle >= 157.5 && this._angle <= 180)\r\n        {\r\n            return 180\r\n        }\r\n        else if(this._angle <= 360 && this._angle >= 337.5 || this._angle >= 0 && this._angle <= 22.5)\r\n        {\r\n            return 0\r\n        }\r\n        else if(this._angle >= 112.5 && this._angle <= 157.5)\r\n        {\r\n            return 135\r\n        }\r\n        else if(this._angle >= 22.5 && this._angle <= 67.5)\r\n        {\r\n            return 45\r\n        }\r\n        else if(this._angle >= 202.5 && this._angle <= 247.5)\r\n        {\r\n            return 225\r\n        }\r\n        else if(this._angle >= 292.5 && this._angle <= 337.5)\r\n        {\r\n            return 315\r\n        }\r\n    },\r\n\r\n    onDestroy: function()\r\n    {\r\n        //cc.eventManager.removeListener(this._listener);\r\n        // this.node.off(\"touchstart\");\r\n        // this.node.off(\"touchmove\");\r\n        // this.node.off(\"touchend\");\r\n\r\n        this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this);\r\n        this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this);\r\n    }\r\n\r\n});\r\n"]}