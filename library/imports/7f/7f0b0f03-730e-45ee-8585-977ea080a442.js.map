{"version":3,"sources":["assets\\scripts\\CityScript.js"],"names":["TankType","require","tankType","alert","cc","Class","Component","properties","curMap","TiledMap","yaogan","Node","bullet","Prefab","tank","type","maxCount","life","bornPoses","Vec2","spriteFrames","SpriteFrame","tankSpeeds","Float","tankFireTimes","tankBloods","Integer","enemyNum","Label","lifeNum","doubleFire","doubleFireBtn","doubleFireFrames","onLoad","_joystickCtrl","getComponent","_tiledMap","string","start","err","show","call","gameData","curLevel","curAngle","self","registerInputEvent","_tiledMapData","_curMapTileSize","getTileSize","_curMapSize","v2","node","width","height","log","mapLayer0","getLayer","bulletPool","NodePool","initBulletCount","i","instantiate","put","tankPool","teamId","single","tankList","bulletList","tankNode","find","player","addPlayerTank","_playerTankCtrl","schedule","addAITank","macro","REPEAT_FOREVER","update","dt","startFire","setDoubleFire","opacity","addJoyStickTouchChangeListener","angle","stopMove","tankMoveStart","tankMoveStop","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","KEY","w","s","a","d","k","fireBtnClick","KEY_UP","collisionTest","rect","xMin","x","xMax","yMin","y","yMax","MinY","MaxY","MinX","MaxX","LeftDown","RightDown","LeftUp","RightUp","MidDown","MidUp","MidLeft","MidRight","_collisionTest","points","point","shift","gid","getTileGIDAt","parseInt","gidToTileType","tileType","tileNone","tileGrass","tileWall","num","Math","random","setTileGIDAt","tileKing","gameOver","length","tankCtrl","tankStop","director","loadScene","team","size","get","Sprite","spriteFrame","position","zIndex","Player","speed","fireTime","blood","die","parent","push","index","collisionTank","getBoundingBox","tankBoom","tankNum","Number","audioEngine","play","shootAudio","onDestroy","unschedule"],"mappings":"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","sourceRoot":"/","sourcesContent":["var TankType = require(\"TankData\").tankType;\r\nlet alert = require('Alert');\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        //地图\r\n        curMap: cc.TiledMap,\r\n        //摇杆\r\n        yaogan: cc.Node,\r\n\r\n        //子弹预制体\r\n        bullet: cc.Prefab,\r\n        //坦克预制体\r\n        tank: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n        //最大数量\r\n        maxCount: 10,\r\n        life: 3,\r\n        //出生地\r\n        bornPoses: {\r\n            default: [],\r\n            type: cc.Vec2,\r\n        },\r\n        //坦克皮肤\r\n        spriteFrames: {\r\n            default: [],\r\n            type: cc.SpriteFrame,\r\n        },\r\n        //坦克移动速度\r\n        tankSpeeds: {\r\n            default: [],\r\n            type: cc.Float,\r\n        },\r\n        //坦克子弹发射间隔时间\r\n        tankFireTimes: {\r\n            default: [],\r\n            type: cc.Float,\r\n        },\r\n\r\n        //坦克血量\r\n        tankBloods: {\r\n            default: [],\r\n            type: cc.Integer,\r\n        },\r\n        \r\n        enemyNum: {\r\n            type: cc.Label,\r\n            default: null,\r\n        },\r\n        lifeNum: {\r\n            type: cc.Label,\r\n            default: null,\r\n        },\r\n        doubleFire: false,\r\n        doubleFireBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        doubleFireFrames: {\r\n            default: [],\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        // cc.director.setDisplayStats(true);\r\n        //获取摇杆控制组件\r\n        this._joystickCtrl = this.yaogan.getComponent(\"JoystickCtrl\");\r\n        //获取地图 TiledMap 组件\r\n        this._tiledMap = this.curMap.getComponent('cc.TiledMap');\r\n        this.enemyNum.string = this.maxCount + \"\";\r\n        this.lifeNum.string = this.life + \"\";\r\n    },\r\n\r\n    start: function(err){\r\n        if(err){\r\n            return;\r\n        }\r\n\r\n        alert.show.call(this, \"关卡\" + cc.gameData.curLevel, function () {\r\n            \r\n        });\r\n\r\n        //默认角度\r\n        this.curAngle = null;\r\n\r\n        var self = this;\r\n        //注册监听事件\r\n        this.registerInputEvent();\r\n        //引入地图数据\r\n        this._tiledMapData = require(\"TiledMapData\");\r\n\r\n        //获取地图尺寸\r\n        this._curMapTileSize = this._tiledMap.getTileSize();\r\n        this._curMapSize = cc.v2(this._tiledMap.node.width,this._tiledMap.node.height);\r\n        cc.log(\"this._curMapTileSize =\" + this._curMapTileSize);\r\n        cc.log(\"this._curMapSize =\" + this._curMapSize);\r\n        \r\n        //地图墙层\r\n        this.mapLayer0 = this._tiledMap.getLayer(\"layer_0\");\r\n\r\n        //初始化对象池(参数必须为对应脚本的文件名)\r\n        this.bulletPool = new cc.NodePool(\"BulletScript\");\r\n        var initBulletCount = 20;\r\n        for(var i=0; i<initBulletCount; ++i){\r\n            var bullet = cc.instantiate(this.bullet);\r\n            this.bulletPool.put(bullet);\r\n        }\r\n        this.tankPool = new cc.NodePool(\"TankScript\");\r\n        for(var i=0; i<this.maxCount; ++i){\r\n            var tank = cc.instantiate(this.tank);\r\n            this.tankPool.put(tank);\r\n        }\r\n        if(!cc.gameData){\r\n            cc.gameData = {};\r\n        }\r\n        //初始化\r\n        cc.gameData.teamId = 0;\r\n        //临时\r\n        cc.gameData.single = true;\r\n\r\n        //地图内坦克列表\r\n        cc.gameData.tankList = [];\r\n        //地图内子弹列表\r\n        cc.gameData.bulletList = [];\r\n\r\n        //获取组件\r\n        this.tankNode = cc.find(\"/Canvas/Map\");\r\n        //this.tankNode = cc.find(\"/Canvas/map1/layer0\");\r\n        //加入player\r\n        this.player = this.addPlayerTank();\r\n        //获取坦克控制组件\r\n        this._playerTankCtrl = this.player.getComponent(\"TankScript\"); \r\n\r\n        //启动定时器，添加坦克\r\n        this.schedule(this.addAITank,3,cc.macro.REPEAT_FOREVER,1);\r\n        \r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this.doubleFire){\r\n            if(this._playerTankCtrl.startFire(this.bulletPool)){\r\n                //播放射击音效\r\n                //cc.audioEngine.play(this._playerTankCtrl.shootAudio, false, 1);\r\n            }\r\n        }\r\n    },\r\n\r\n    setDoubleFire: function () {\r\n        this.doubleFire = !this.doubleFire;\r\n        \r\n        if(this.doubleFire){\r\n            this.doubleFireBtn.opacity = 240\r\n            //this.doubleFireBtn.getComponent(cc.Sprite).spriteFrame = this.doubleFireFrames[1];\r\n        }else{\r\n            this.doubleFireBtn.opacity = 255\r\n            //this.doubleFireBtn.getComponent(cc.Sprite).spriteFrame = this.doubleFireFrames[0];\r\n        }\r\n        \r\n    },\r\n\r\n    //注册输入事件\r\n    registerInputEvent: function () {\r\n\r\n        var self = this;\r\n\r\n        this._joystickCtrl.addJoyStickTouchChangeListener(function (angle) {\r\n            \r\n            if(angle == self.curAngle &&\r\n                !self._playerTankCtrl.stopMove ){\r\n                return;\r\n            }\r\n            self.curAngle = angle;\r\n\r\n            if(angle!=null){\r\n                //开始前进\r\n                self._playerTankCtrl.tankMoveStart(angle);\r\n            }else {\r\n                //停止前进\r\n                self._playerTankCtrl.tankMoveStop();\r\n            }\r\n\r\n        });\r\n        //按键按下\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, \r\n                        function (event) {\r\n                            var angle = null;\r\n                            switch(event.keyCode) {\r\n                                case cc.macro.KEY.w:\r\n                                    angle = 90;\r\n                                    break;\r\n                                case cc.macro.KEY.s:\r\n                                    angle = 270;\r\n                                    break;\r\n                                case cc.macro.KEY.a:\r\n                                    angle = 180;\r\n                                    break;\r\n                                case cc.macro.KEY.d:\r\n                                    angle = 0;\r\n                                    break;\r\n                            }\r\n                            if(event.keyCode == cc.macro.KEY.k){\r\n                                this.fireBtnClick();\r\n                            }else {\r\n                                self._playerTankCtrl.tankMoveStop();\r\n                            }\r\n                            if(angle!=null){\r\n                                //开始前进\r\n                                self._playerTankCtrl.tankMoveStart(angle);\r\n                            }\r\n                        }, this);\r\n        //按键抬起\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, \r\n                        function (event){\r\n                            //停止前进\r\n                            if(event.keyCode != cc.macro.KEY.k){\r\n                                self._playerTankCtrl.tankMoveStop();\r\n                            }\r\n                        }, this);\r\n\r\n    },\r\n\r\n    //碰撞检测\r\n    collisionTest: function(rect, bullet){\r\n        //判断是否碰到地图边界\r\n        if (rect.xMin <= -this._curMapSize.x/2 || rect.xMax >= this._curMapSize.x/2 ||\r\n\t\t    rect.yMin <= -this._curMapSize.y/2 || rect.yMax >= this._curMapSize.y/2){\r\n                \r\n            return true;\r\n        }\r\n        //判断是否撞墙\r\n        //将坐标转换为地图坐标系\r\n        var MinY = this._curMapSize.y/2 - rect.yMin;\r\n\t    var MaxY = this._curMapSize.y/2 - rect.yMax;\r\n        var MinX = this._curMapSize.x/2 + rect.xMin;\r\n        var MaxX = this._curMapSize.x/2 + rect.xMax;\r\n\r\n        //获取四个角的顶点\r\n        var LeftDown = cc.v2(MinX, MinY);\r\n        var RightDown = cc.v2(MaxX, MinY);\r\n        var LeftUp = cc.v2(MinX, MaxY);\r\n        var RightUp = cc.v2(MaxX, MaxY);\r\n\r\n        //获取四条边的中心点\r\n        var MidDown = cc.v2(MinX+(MaxX-MinX)/2, MinY);\r\n        var MidUp = cc.v2(MinX+(MaxX-MinX)/2, MaxY);\r\n        var MidLeft = cc.v2(MinX, MinY+(MaxY-MinY)/2);\r\n        var MidRight= cc.v2(MaxX, MinY+(MaxY-MinY)/2);\r\n\r\n        //检测碰撞\r\n        return this._collisionTest([LeftDown,RightDown,LeftUp,RightUp,\r\n                        MidDown,MidUp,MidLeft,MidRight],\r\n                        bullet);\r\n    },\r\n\r\n    //内部碰撞检测方法\r\n    _collisionTest: function(points, bullet){\r\n        var point = points.shift()\r\n        var gid = this.mapLayer0.getTileGIDAt(cc.v2(parseInt(point.x / this._curMapTileSize.width),parseInt(point.y / this._curMapTileSize.height)));\r\n\r\n        if (this._tiledMapData.gidToTileType[gid] != this._tiledMapData.tileType.tileNone && \r\n            this._tiledMapData.gidToTileType[gid] != this._tiledMapData.tileType.tileGrass){\r\n\r\n            if(bullet && this._tiledMapData.gidToTileType[gid] == this._tiledMapData.tileType.tileWall){\r\n\r\n                var num = parseInt(Math.random()*(13-10+1)+10,10);\r\n \r\n                this.mapLayer0.setTileGIDAt(num, parseInt(point.x / this._curMapTileSize.width),parseInt(point.y / this._curMapTileSize.height), 1);\r\n            }\r\n            else if(bullet && this._tiledMapData.gidToTileType[gid] == this._tiledMapData.tileType.tileKing){\r\n\r\n                this.mapLayer0.setTileGIDAt(0, parseInt(point.x / this._curMapTileSize.width),parseInt(point.y / this._curMapTileSize.height), 1);\r\n                this.gameOver();\r\n            }\r\n            return true;\r\n        }\r\n\r\n        if(points.length>0){\r\n            return this._collisionTest(points, bullet);\r\n        }else{\r\n            return false;\r\n        }\r\n    },\r\n\r\n    gameOver: function(){\r\n        this.doubleFire = false;\r\n        for(var i=0; i<cc.gameData.tankList.length; i++){\r\n            var tank = cc.gameData.tankList[i]\r\n            var tankCtrl = tank.getComponent(\"TankScript\");\r\n            tankCtrl.tankStop();\r\n        }\r\n\r\n        //弹窗调用\r\n        alert.show.call(this, \"游戏结束\", function () {\r\n            cc.director.loadScene(\"StartScene\");\r\n        });\r\n    },\r\n\r\n    //加入玩家坦克\r\n    addPlayerTank: function(team) {\r\n        if(this.tankPool.size()>0){\r\n            var tank = this.tankPool.get();\r\n            tank.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[this.spriteFrames.length-1];\r\n            tank.position = this.bornPoses[this.bornPoses.length-1];\r\n            tank.zIndex = -1;\r\n            //获取坦克控制组件\r\n            var tankCtrl = tank.getComponent(\"TankScript\");\r\n            //设置坦克属性\r\n            tankCtrl.tankType = TankType.Player;\r\n            tankCtrl.speed = this.tankSpeeds[this.tankSpeeds.length-1];\r\n            tankCtrl.fireTime = this.tankFireTimes[this.tankFireTimes.length-1];\r\n            //tankCtrl.blood = this.tankBloods[this.tankBloods.length-1];\r\n            //tankCtrl.blood = this.life ;\r\n            tankCtrl.blood = 1;\r\n            tankCtrl.die = false;\r\n            \r\n            if(!team){\r\n                if(cc.gameData.single){\r\n                    //单机版\r\n                    tankCtrl.team = 0;\r\n                }else {\r\n                    //大乱斗\r\n                    tankCtrl.team = ++cc.gameData.teamId;\r\n                }\r\n                \r\n            }else {\r\n                //组队\r\n                tankCtrl.team = team;\r\n            }\r\n\r\n            tank.parent = this.tankNode;\r\n            //加到列表\r\n            cc.gameData.tankList.push(tank);\r\n            return tank;\r\n        }\r\n        return null;\r\n    },\r\n\r\n    //加入AI\r\n    addAITank: function(dt, team) {\r\n        if(this.tankPool.size()>0 && this.maxCount > 0){\r\n            var tank = this.tankPool.get();\r\n            tank.zIndex = -1;\r\n            var index = parseInt(Math.random()*3, 10);\r\n            //获取坦克控制组件\r\n            var tankCtrl = tank.getComponent(\"TankScript\");\r\n            //设置坦克属性\r\n            tank.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[index];\r\n            tank.position = this.bornPoses[index];\r\n\r\n            tankCtrl.tankType = index;\r\n            tankCtrl.speed = this.tankSpeeds[index];\r\n            tankCtrl.fireTime = this.tankFireTimes[index];\r\n            tankCtrl.blood = this.tankBloods[index];\r\n            tankCtrl.die = false;\r\n\r\n            if(!team){\r\n                if(cc.gameData.single){\r\n                    //单机版\r\n                    tankCtrl.team = 1;\r\n                }else {\r\n                    //大乱斗\r\n                    tankCtrl.team = ++cc.gameData.teamId;\r\n                }\r\n            }else {\r\n                //组队\r\n                tankCtrl.team = team;\r\n            }\r\n\r\n            if(index == 0){\r\n                tank.angle = 90;\r\n            }else if(index == 1){\r\n                tank.angle = 180;\r\n            }else if(index == 2){\r\n                tank.angle = 270;\r\n            }\r\n            if(tankCtrl.collisionTank(tank.getBoundingBox())){\r\n                for(var i=0; i<this.bornPoses.length-1; i++){\r\n                    tank.position = this.bornPoses[i];\r\n                    if(!tankCtrl.collisionTank(tank.getBoundingBox())){\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            tank.parent = this.tankNode;\r\n            //加到列表\r\n            cc.gameData.tankList.push(tank);\r\n            this.maxCount --;\r\n        }\r\n    },\r\n\r\n    tankBoom: function(tank) {\r\n        \r\n        if(cc.gameData.single && tank.getComponent(\"TankScript\").team == 0){\r\n            // this.life --;\r\n            // this.lifeNum.string = this.life + \"\";\r\n\r\n            // if(this.life > 0){\r\n            //     this.addPlayerTank();\r\n            // }else{\r\n            //     this.gameOver();\r\n            // }\r\n            // tank.getComponent(\"TankScript\").blood = 1;\r\n        }\r\n        else{\r\n            tank.parent = null;\r\n        tank.getComponent(\"TankScript\").die = true;\r\n        this.tankPool.put(tank);\r\n\r\n            tank.parent = null;\r\n            tank.getComponent(\"TankScript\").die = true;\r\n            this.tankPool.put(tank);\r\n\r\n            var tankNum = Number(this.enemyNum.string) - 1;\r\n            this.enemyNum.string = tankNum + \"\";\r\n            if(tankNum == 0){\r\n                if(cc.gameData.curLevel < 10){\r\n                    ++cc.gameData.curLevel;\r\n                    cc.director.loadScene(\"CityScene\"+ cc.gameData.curLevel);\r\n                }\r\n                else{\r\n                    this.doubleFire = false;\r\n                    alert.show.call(this, \"你赢了\", function () {\r\n                        cc.director.loadScene(\"StartScene\");\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //开火按钮点击\r\n    fireBtnClick: function(){\r\n        if(this._playerTankCtrl.startFire(this.bulletPool)){\r\n            //播放射击音效\r\n            cc.audioEngine.play(this._playerTankCtrl.shootAudio, false, 1);\r\n        }\r\n    },\r\n\r\n    //销毁时调用\r\n    onDestroy: function () {\r\n        this.unschedule(this.addAITank,this);\r\n    },\r\n});\r\n"]}